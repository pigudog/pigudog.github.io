<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>R语言入门和数据分析 | PiguDog的小屋</title><meta name="keywords" content="R"><meta name="author" content="pigudog,2205638116@qq.com"><meta name="copyright" content="pigudog"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="R语言入门和数据分析参考视频  基本操作 环境：前面配置的服务器  首先我们要学会查看和设置我们的工作目录 12&gt; getwd()[1] &quot;&#x2F;home&#x2F;pigudogzyy100&#x2F;R_study&quot;  修改目录 123&gt; setwd(&quot;&#x2F;home&#x2F;pigudogzyy100&#x2F;project&#x2F;airway&#x2F;test&#x2F;&quot;)&gt; getwd()[1]">
<meta property="og:type" content="article">
<meta property="og:title" content="R语言入门和数据分析">
<meta property="og:url" content="http://example.com/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/index.html">
<meta property="og:site_name" content="PiguDog的小屋">
<meta property="og:description" content="R语言入门和数据分析参考视频  基本操作 环境：前面配置的服务器  首先我们要学会查看和设置我们的工作目录 12&gt; getwd()[1] &quot;&#x2F;home&#x2F;pigudogzyy100&#x2F;R_study&quot;  修改目录 123&gt; setwd(&quot;&#x2F;home&#x2F;pigudogzyy100&#x2F;project&#x2F;airway&#x2F;test&#x2F;&quot;)&gt; getwd()[1]">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg.png">
<meta property="article:published_time" content="2022-11-15T16:00:00.000Z">
<meta property="article:modified_time" content="2022-11-16T10:55:56.872Z">
<meta property="article:author" content="pigudog">
<meta property="article:tag" content="R">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: pigudog","link":"Link: ","source":"Source: PiguDog的小屋","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'R语言入门和数据分析',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-16 18:55:56'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.gif" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">16</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">PiguDog的小屋</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">R语言入门和数据分析<a class="post-edit-link" href="https://github.com/pigudog/_posts/R语言/R4.md" title="Edited on" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-11-15T16:00:00.000Z" title="Created 2022-11-16 00:00:00">2022-11-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-11-16T10:55:56.872Z" title="Updated 2022-11-16 18:55:56">2022-11-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/medical/">medical</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/medical/R/">R</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="R语言入门和数据分析"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="R语言入门和数据分析"><a href="#R语言入门和数据分析" class="headerlink" title="R语言入门和数据分析"></a>R语言入门和数据分析</h1><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19x411X7C6/?spm_id_from=333.337.search-card.all.click&vd_source=360bc66c11e9b8c05a44ec9aa5da35c9">参考视频</a> </p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><ul>
<li>环境：前面配置的服务器</li>
</ul>
<p>首先我们要学会查看和设置我们的工作目录</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> getwd<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;/home/pigudogzyy100/R_study&quot;</span></span><br></pre></td></tr></table></figure>

<p>修改目录</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> setwd<span class="punctuation">(</span><span class="string">&quot;/home/pigudogzyy100/project/airway/test/&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> getwd<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;/home/pigudogzyy100/project/airway/test&quot;</span></span><br></pre></td></tr></table></figure>

<p>我们也可以查看当前目录下的的文件</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> list.files<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;BLCA_93663_50_50.csv&quot;</span>                                          </span><br><span class="line"> <span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="string">&quot;cor.png&quot;</span>                                                       </span><br><span class="line"> <span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span> <span class="string">&quot;DEG_top100.png&quot;</span>                                                </span><br><span class="line"> <span class="punctuation">[</span><span class="number">4</span><span class="punctuation">]</span> <span class="string">&quot;DEseq_RAWvsNORM.png&quot;</span>                                           </span><br><span class="line"> <span class="punctuation">[</span><span class="number">5</span><span class="punctuation">]</span> <span class="string">&quot;dispersions.png&quot;</span>                                               </span><br><span class="line"> <span class="punctuation">[</span><span class="number">6</span><span class="punctuation">]</span> <span class="string">&quot;ensembl.txt&quot;</span>                                                   </span><br><span class="line"> <span class="punctuation">[</span><span class="number">7</span><span class="punctuation">]</span> <span class="string">&quot;geneID2symbol.csv&quot;</span>                                             </span><br><span class="line"> <span class="punctuation">[</span><span class="number">8</span><span class="punctuation">]</span> <span class="string">&quot;GSE111229_Mammary_Tumor_fibroblasts_768samples_rawCounts.csv&quot;</span>  </span><br><span class="line"> <span class="punctuation">[</span><span class="number">9</span><span class="punctuation">]</span> <span class="string">&quot;GSE111229_Mammary_Tumor_fibroblasts_768samples_rawCounts.Rdata&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">10</span><span class="punctuation">]</span> <span class="string">&quot;GSE111229_Mammary_Tumor_fibroblasts_768samples_rawCounts.txt&quot;</span>  </span><br><span class="line"><span class="punctuation">[</span><span class="number">11</span><span class="punctuation">]</span> <span class="string">&quot;GSE42872_eSet.Rdata&quot;</span>                                           </span><br><span class="line"><span class="punctuation">[</span><span class="number">12</span><span class="punctuation">]</span> <span class="string">&quot;GSE42872_series_matrix.txt.gz&quot;</span>                                 </span><br><span class="line"><span class="punctuation">[</span><span class="number">13</span><span class="punctuation">]</span> <span class="string">&quot;hclust.png&quot;</span>                                                    </span><br><span class="line"><span class="punctuation">[</span><span class="number">14</span><span class="punctuation">]</span> <span class="string">&quot;heatmap.png&quot;</span>                                                   </span><br><span class="line"><span class="punctuation">[</span><span class="number">15</span><span class="punctuation">]</span> <span class="string">&quot;input.Rdata&quot;</span>                                                   </span><br><span class="line"><span class="punctuation">[</span><span class="number">16</span><span class="punctuation">]</span> <span class="string">&quot;plot.txt&quot;</span>                                                      </span><br><span class="line"><span class="punctuation">[</span><span class="number">17</span><span class="punctuation">]</span> <span class="string">&quot;R_study_1_package.R&quot;</span>                                           </span><br><span class="line"><span class="punctuation">[</span><span class="number">18</span><span class="punctuation">]</span> <span class="string">&quot;R_study_10_RNAseq.R&quot;</span>                                           </span><br><span class="line"><span class="punctuation">[</span><span class="number">19</span><span class="punctuation">]</span> <span class="string">&quot;R_study_2_variables.R&quot;</span>                                         </span><br><span class="line"><span class="punctuation">[</span><span class="number">20</span><span class="punctuation">]</span> <span class="string">&quot;R_study_3_OIdata.R&quot;</span>                                            </span><br><span class="line"><span class="punctuation">[</span><span class="number">21</span><span class="punctuation">]</span> <span class="string">&quot;R_study_4_pheatmap1.R&quot;</span>                                         </span><br><span class="line"><span class="punctuation">[</span><span class="number">22</span><span class="punctuation">]</span> <span class="string">&quot;R_study_4_pheatmap2.R&quot;</span>                                         </span><br><span class="line"><span class="punctuation">[</span><span class="number">23</span><span class="punctuation">]</span> <span class="string">&quot;R_study_5_chid.R&quot;</span>                                              </span><br><span class="line"><span class="punctuation">[</span><span class="number">24</span><span class="punctuation">]</span> <span class="string">&quot;R_study_6_surAnlysis.R&quot;</span>                                        </span><br><span class="line"><span class="punctuation">[</span><span class="number">25</span><span class="punctuation">]</span> <span class="string">&quot;R_study_7_boxplot_from_cbioportal.R&quot;</span>                           </span><br><span class="line"><span class="punctuation">[</span><span class="number">26</span><span class="punctuation">]</span> <span class="string">&quot;R_study_8_cor_expression_matrix.R&quot;</span>                             </span><br><span class="line"><span class="punctuation">[</span><span class="number">27</span><span class="punctuation">]</span> <span class="string">&quot;R_study_9_chip.R&quot;</span>                                              </span><br><span class="line"><span class="punctuation">[</span><span class="number">28</span><span class="punctuation">]</span> <span class="string">&quot;R_study.Rproj&quot;</span>                                                 </span><br><span class="line"><span class="punctuation">[</span><span class="number">29</span><span class="punctuation">]</span> <span class="string">&quot;sample.csv&quot;</span>                                                    </span><br><span class="line"><span class="punctuation">[</span><span class="number">30</span><span class="punctuation">]</span> <span class="string">&quot;SraRunTable.csv&quot;</span>                                               </span><br><span class="line"><span class="punctuation">[</span><span class="number">31</span><span class="punctuation">]</span> <span class="string">&quot;SraRunTable.txt&quot;</span>                                               </span><br><span class="line"><span class="punctuation">[</span><span class="number">32</span><span class="punctuation">]</span> <span class="string">&quot;survival_ARHGAP1_in_LGG.png&quot;</span>                                   </span><br><span class="line"><span class="punctuation">[</span><span class="number">33</span><span class="punctuation">]</span> <span class="string">&quot;test.pdf&quot;</span>                                                      </span><br><span class="line"><span class="punctuation">[</span><span class="number">34</span><span class="punctuation">]</span> <span class="string">&quot;volcano.png&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir() # 也可以完成同样的工作</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 赋值</span><br><span class="line">&gt; x = 3</span><br><span class="line">&gt; x</span><br><span class="line">[1] 3</span><br><span class="line">&gt; x &lt;- 4 </span><br><span class="line">&gt; x</span><br><span class="line">[1] 4</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 函数</span><br><span class="line">sum()</span><br><span class="line">mean()</span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span>ls<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment"># 列出当前的变量</span></span><br><span class="line"><span class="operator">&gt;</span>ls.str<span class="punctuation">(</span><span class="punctuation">)</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="number">5</span> <span class="operator">-&gt;</span> x</span><br><span class="line"><span class="operator">&gt;</span> x</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">5</span></span><br><span class="line"><span class="operator">&gt;</span> ls<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;x&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> ls.str<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">x <span class="operator">:</span>  num <span class="number">5</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check the download location of packages</span></span><br><span class="line">.libPaths<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># check the list of download packages</span></span><br><span class="line">library<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># install more than one pakages</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;AER&quot;</span><span class="punctuation">,</span><span class="string">&quot;ca&quot;</span><span class="punctuation">,</span><span class="string">&quot;...&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># load package</span></span><br><span class="line">require<span class="punctuation">(</span>vcd<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># remove loading</span></span><br><span class="line">detach<span class="punctuation">(</span><span class="string">&quot;package:vcd&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># remove package</span></span><br><span class="line">remove.package<span class="punctuation">(</span><span class="string">&quot;vcd&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># check the package installed</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># view the tool package help information</span></span><br><span class="line">help<span class="punctuation">(</span>package<span class="operator">=</span><span class="string">&quot;vcd&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>help <span class="operator">=</span><span class="string">&quot;vcd&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># list the all the functions of selected packages</span></span><br><span class="line">ls<span class="punctuation">(</span><span class="string">&quot;package:vcd&quot;</span><span class="punctuation">)</span> <span class="comment">## after loading</span></span><br><span class="line"><span class="comment"># list all the dataset of vcd</span></span><br><span class="line">data<span class="punctuation">(</span>package<span class="operator">=</span><span class="string">&quot;vcd&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Batch migration of R packages</span></span><br><span class="line">Rpackage <span class="operator">&lt;-</span> installed.packages<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> save<span class="punctuation">(</span>Rpackage<span class="punctuation">,</span>file<span class="operator">=</span><span class="string">&quot;Rpack.Rdata)</span></span><br><span class="line"><span class="string"># or batch download</span></span><br><span class="line"><span class="string">for (i in Rpack)</span></span><br><span class="line"><span class="string">	install.packages(i)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># help information</span></span><br><span class="line">help<span class="punctuation">(</span><span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">?</span><span class="operator">?</span>help</span><br><span class="line"><span class="comment"># quickly check the arguments of selected function</span></span><br><span class="line"><span class="operator">&gt;</span> args<span class="punctuation">(</span>pheatmap<span class="punctuation">)</span></span><br><span class="line"><span class="keyword">function</span> <span class="punctuation">(</span>mat<span class="punctuation">,</span> color <span class="operator">=</span> colorRampPalette<span class="punctuation">(</span>rev<span class="punctuation">(</span>brewer.pal<span class="punctuation">(</span>n <span class="operator">=</span> <span class="number">7</span><span class="punctuation">,</span> ...</span><br><span class="line"><span class="comment"># function og esample for example</span></span><br><span class="line">example<span class="punctuation">(</span><span class="string">&quot;hist&quot;</span><span class="punctuation">)</span>												   <span class="comment"># online													   </span></span><br><span class="line">help<span class="punctuation">(</span>package<span class="operator">=</span>vcd<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>R内置了很多的数据集,存在于datasets这个包中<br>直接<code>data()</code>就可以列出很多的数据集,<code>rivers</code>可以列出北美141条河流的长度<br>可以用<code>help(&quot;mtcars&quot;)</code>这样的去查看数据的帮助信息<br>加载数据集</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> data<span class="punctuation">(</span>package<span class="operator">=</span><span class="string">&quot;MASS&quot;</span><span class="punctuation">)</span>  </span><br></pre></td></tr></table></figure>
<p>这样只是加载数据集,而包就不用加载进来</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> data<span class="punctuation">(</span>Chile<span class="punctuation">,</span>Package<span class="operator">=</span><span class="string">&quot;car&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>数据结构在R1笔记中又在github中上传了，主要包括向量；矩阵；数组；数据框等</p>
<p>一些不适用dollar符号的操作</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> attach<span class="punctuation">(</span>mtcars<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> mpg  数据框的名称</span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">21.0</span> <span class="number">21.0</span> <span class="number">22.8</span> <span class="number">21.4</span> <span class="number">18.7</span> <span class="number">18.1</span> <span class="number">14.3</span> <span class="number">24.4</span> <span class="number">22.8</span> <span class="number">19.2</span> <span class="number">17.8</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">12</span><span class="punctuation">]</span> <span class="number">16.4</span> <span class="number">17.3</span> <span class="number">15.2</span> <span class="number">10.4</span> <span class="number">10.4</span> <span class="number">14.7</span> <span class="number">32.4</span> <span class="number">30.4</span> <span class="number">33.9</span> <span class="number">21.5</span> <span class="number">15.5</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">23</span><span class="punctuation">]</span> <span class="number">15.2</span> <span class="number">13.3</span> <span class="number">19.2</span> <span class="number">27.3</span> <span class="number">26.0</span> <span class="number">30.4</span> <span class="number">15.8</span> <span class="number">19.7</span> <span class="number">15.0</span> <span class="number">21.4</span></span><br></pre></td></tr></table></figure>

<p><code>with</code>函数,不过要一个一个的加载,一般还是推荐使用$符号</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> with<span class="punctuation">(</span>mtcars<span class="punctuation">,</span><span class="punctuation">&#123;</span>hp<span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> hp</span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">110</span> <span class="number">110</span>  <span class="number">93</span> <span class="number">110</span> <span class="number">175</span> <span class="number">105</span> <span class="number">245</span>  <span class="number">62</span>  <span class="number">95</span> <span class="number">123</span> <span class="number">123</span> <span class="number">180</span> <span class="number">180</span> <span class="number">180</span> <span class="number">205</span> <span class="number">215</span> <span class="number">230</span>  <span class="number">66</span>  <span class="number">52</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">20</span><span class="punctuation">]</span>  <span class="number">65</span>  <span class="number">97</span> <span class="number">150</span> <span class="number">150</span> <span class="number">245</span> <span class="number">175</span>  <span class="number">66</span>  <span class="number">91</span> <span class="number">113</span> <span class="number">264</span> <span class="number">175</span> <span class="number">335</span> <span class="number">109</span></span><br></pre></td></tr></table></figure>

<p>新概念：因子</p>
<ul>
<li>变量的分类可以简单分为字符串、有序变量、连续型变量</li>
<li>在R中名义型变量(字符串)和有序变量称为因子，factor</li>
<li>这些分类变量的可能值称为一个水平level<ul>
<li>例如good,better,best,都称为一个level. 有这些水平值构成的向量就称为因子.</li>
</ul>
</li>
<li>因子的应用<ul>
<li>计算频数 - 独立性检验 - 相关性检验 - 方差分析 - 主成分分析 - 因子分析等</li>
</ul>
</li>
<li>table频数统计.cyl就是一个因子,4,6,8就是水平<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> mtcars<span class="operator">$</span>cyl</span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">6</span> <span class="number">6</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span> <span class="number">6</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">6</span> <span class="number">6</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">8</span> <span class="number">6</span> <span class="number">8</span> <span class="number">4</span></span><br><span class="line"><span class="operator">&gt;</span> table<span class="punctuation">(</span>cyl<span class="punctuation">)</span></span><br><span class="line">cyl</span><br><span class="line"> <span class="number">4</span>  <span class="number">6</span>  <span class="number">8</span> </span><br><span class="line"><span class="number">11</span>  <span class="number">7</span> <span class="number">14</span></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> week <span class="operator">=</span> factor<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Mon&quot;</span><span class="punctuation">,</span><span class="string">&quot;Fri&quot;</span><span class="punctuation">,</span><span class="string">&quot;Tue&quot;</span><span class="punctuation">,</span><span class="string">&quot;Wed&quot;</span><span class="punctuation">,</span><span class="string">&quot;Mon&quot;</span><span class="punctuation">,</span><span class="string">&quot;Fri&quot;</span><span class="punctuation">,</span><span class="string">&quot;Sun&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>ordered <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span>levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Mon&quot;</span><span class="punctuation">,</span><span class="string">&quot;Tue&quot;</span><span class="punctuation">,</span><span class="string">&quot;Wed&quot;</span><span class="punctuation">,</span><span class="string">&quot;Thu&quot;</span><span class="punctuation">,</span><span class="string">&quot;Fri&quot;</span><span class="punctuation">,</span><span class="string">&quot;Sat&quot;</span><span class="punctuation">,</span><span class="string">&quot;Sun&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> week</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> Mon Fri Tue Wed Mon Fri Sun</span><br><span class="line">Levels<span class="operator">:</span> Mon <span class="operator">&lt;</span> Tue <span class="operator">&lt;</span> Wed <span class="operator">&lt;</span> Thu <span class="operator">&lt;</span> Fri <span class="operator">&lt;</span> Sat <span class="operator">&lt;</span> Sun</span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> fcyl <span class="operator">=</span> factor<span class="punctuation">(</span>mtcars<span class="operator">$</span>cyl<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> fcyl </span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">6</span> <span class="number">6</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span> <span class="number">6</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">6</span> <span class="number">6</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">8</span> <span class="number">6</span> <span class="number">8</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">32</span><span class="punctuation">]</span> <span class="number">4</span></span><br><span class="line">Levels<span class="operator">:</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> fcyl <span class="operator">=</span> factor<span class="punctuation">(</span>mtcars<span class="operator">$</span>cyl<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> fcyl </span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">6</span> <span class="number">6</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span> <span class="number">6</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">6</span> <span class="number">6</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">8</span> <span class="number">4</span> <span class="number">4</span> <span class="number">4</span> <span class="number">8</span> <span class="number">6</span> <span class="number">8</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">32</span><span class="punctuation">]</span> <span class="number">4</span></span><br><span class="line">Levels<span class="operator">:</span> <span class="number">4</span> <span class="number">6</span> <span class="number">8</span></span><br><span class="line"><span class="operator">&gt;</span> plot<span class="punctuation">(</span>fcyl <span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114181603.png"></p>
<h2 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h2><p>缺失数据可分为 - 完全随机缺失 - 随机缺失 - 非随机缺失 缺失可能是设备故障,测量的问题导致的</p>
<p><code>NA</code>表示缺失not available的简称,不是没有值,知识未知的数值.</p>
<p>统计的时候跳过缺失值,但是平均值的时候还是按照全部的值的个数计算的.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> a <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">:</span><span class="number">49</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">sum</span><span class="punctuation">(</span>a<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">NA</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">sum</span><span class="punctuation">(</span>a<span class="punctuation">,</span>na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1225</span></span><br><span class="line"><span class="operator">&gt;</span> mean<span class="punctuation">(</span>a<span class="punctuation">,</span>na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">25</span></span><br></pre></td></tr></table></figure>

<p>用<code>na.omit()</code>去除缺失值</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="built_in">c</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">:</span><span class="number">20</span><span class="punctuation">,</span><span class="literal">NA</span><span class="punctuation">,</span><span class="literal">NA</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">c</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">NA</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">22</span><span class="punctuation">]</span> <span class="literal">NA</span> <span class="literal">NA</span></span><br><span class="line"><span class="operator">&gt;</span> d <span class="operator">=</span> na.omit<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> d</span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span></span><br><span class="line"><span class="built_in">attr</span><span class="punctuation">(</span><span class="punctuation">,</span><span class="string">&quot;na.action&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>  <span class="number">1</span> <span class="number">22</span> <span class="number">23</span></span><br><span class="line"><span class="built_in">attr</span><span class="punctuation">(</span><span class="punctuation">,</span><span class="string">&quot;class&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;omit&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="其他缺失数据"><a href="#其他缺失数据" class="headerlink" title="其他缺失数据"></a>其他缺失数据</h3><ol>
<li>缺失数据NaN,代表不可能的值;</li>
<li>Inf表示无穷,分为正无穷Inf和负无穷Inf,代表无穷大或者无穷小.</li>
<li>Inf存在,是无穷大后者无穷小,但是表示不可能的值.  </li>
<li>可以用<code>is.nan()</code>来识别不可能值  </li>
<li>可以用<code>is.infinite()</code>来识别无穷值</li>
</ol>
<h2 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h2><h3 id="xlsx数据库的安装"><a href="#xlsx数据库的安装" class="headerlink" title="xlsx数据库的安装"></a>xlsx数据库的安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">install.package(&quot;xlsx&quot;)</span><br></pre></td></tr></table></figure>
<p>先报了一个错:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Make sure you have Java Development Kit installed and correctly registered in R.</span><br><span class="line">If in doubt, re-run &quot;R CMD javareconf&quot; as root.</span><br></pre></td></tr></table></figure>

<p>查看你看一下java 的版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-17-centos ~]# java -version</span><br><span class="line">openjdk version &quot;1.8.0_345&quot;</span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_345-b01)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.345-b01, mixed mode)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/10/install/installation-jdk-and-jre-linux-platforms.htm#JSJIG-GUID-737A84E4-2EFF-4D38-8E60-3E29D1B884B8">https://docs.oracle.com/javase/10/install/installation-jdk-and-jre-linux-platforms.htm#JSJIG-GUID-737A84E4-2EFF-4D38-8E60-3E29D1B884B8</a><br>我们访问一下官网，找到安装包链接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.oracle.com/javase/10/install/installation-jdk-and-jre-linux-platforms.htm#GUID-ADC9C14A-5F51-4C32-802C-9639A947317F</span><br></pre></td></tr></table></figure>

<p>找到的参考方案：<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/367821455">https://zhuanlan.zhihu.com/p/367821455</a></p>
<p>首先我们尝试了一下在终端运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">R CMD javareconf</span><br><span class="line"></span><br><span class="line">Java interpreter : /usr/bin/java</span><br><span class="line">Java version     : 1.8.0_345</span><br><span class="line">Java home path   : /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.345.b01-1.el7_9.x86_64/jre</span><br><span class="line">Java compiler    : /usr/bin/javac</span><br><span class="line">Java headers gen.: /usr/bin/javah</span><br><span class="line">Java archive tool: /usr/bin/jar</span><br><span class="line"></span><br><span class="line">trying to compile and link a JNI program </span><br><span class="line">detected JNI cpp flags    : -I$(JAVA_HOME)/../include -I$(JAVA_HOME)/../include/linux</span><br><span class="line">detected JNI linker flags : -L$(JAVA_HOME)/lib/amd64/server -ljvm</span><br><span class="line">gcc -std=gnu11 -I&quot;/opt/R/4.2.1/lib/R/include&quot; -DNDEBUG -I/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.345.b01-1.el7_9.x86_64/jre/../include -I/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.345.b01-1.el7_9.x86_64/jre/../include/linux  -I/usr/local/include   -fpic  -g -O2  -c conftest.c -o conftest.o</span><br><span class="line">gcc -std=gnu11 -shared -L/opt/R/4.2.1/lib/R/lib -L/usr/local/lib -o conftest.so conftest.o -L/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.345.b01-1.el7_9.x86_64/jre/lib/amd64/server -ljvm -L/opt/R/4.2.1/lib/R/lib -lR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">JAVA_HOME        : /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.345.b01-1.el7_9.x86_64/jre</span><br><span class="line">Java library path: $(JAVA_HOME)/lib/amd64/server</span><br><span class="line">JNI cpp flags    : -I$(JAVA_HOME)/../include -I$(JAVA_HOME)/../include/linux</span><br><span class="line">JNI linker flags : -L$(JAVA_HOME)/lib/amd64/server -ljvm</span><br><span class="line">Updating Java configuration in /opt/R/4.2.1/lib/R</span><br><span class="line">/opt/R/4.2.1/lib/R/bin/javareconf: line 399: /opt/R/4.2.1/lib/R/etc/Makeconf.new: Permission denied</span><br><span class="line">*** cannot create /opt/R/4.2.1/lib/R/etc/Makeconf.new</span><br><span class="line">*** Please run as root if required.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下载完成后，又报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Error: package or namespace load failed for ‘xlsx’:</span><br><span class="line"> .onLoad failed in loadNamespace() for &#x27;rJava&#x27;, details:</span><br><span class="line"> call: dyn.load(file, DLLpath = DLLpath, ...)</span><br><span class="line">  error: unable to load shared object &#x27;/home/pigudogzyy100/R/x86_64-pc-linux-gnu-library/4.2/rJava/libs/rJava.so&#x27;:</span><br><span class="line">  libjvm.so: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">参考：</span><br><span class="line">这种情况，一般是系统中装了JAVA环境后安装其他软件的时候再次装了JAVA的类库rJava.dll，R的运行环境无法调用确认项。找到自己安装的JAVA环境，去配置R的系统环境中的rJava.dll：</span><br><span class="line"></span><br><span class="line">&gt;Sys.setenv(JAVA_HOME=&#x27;D:/Program Files (x86)/Java/jdk1.8.0_144/jre&#x27;)</span><br><span class="line"></span><br><span class="line">    再次运行library(xlsx),就可以了！</span><br><span class="line"></span><br><span class="line">&gt;library(xlsx)</span><br><span class="line">载入需要的程辑包：rJava</span><br><span class="line">载入需要的程辑包：xlsxjars</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sys.setenv(JAVA_HOME=&quot;/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.352.b08-2.el7_9.x86_64/jre&quot;)</span><br></pre></td></tr></table></figure>
<p>但是操作后没有用？？</p>
<p>难道是权限不够？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(base) [pigudogzyy100@VM-4-17-centos home]$ sudo chmod -R 777 /home/local</span><br><span class="line">(base) [pigudogzyy100@VM-4-17-centos home]$ cd /home/pigudogzyy100/R/x86_64-pc-linux-gnu-library/4.2/rJava/libs/</span><br><span class="line">(base) [pigudogzyy100@VM-4-17-centos libs]$ ll</span><br><span class="line">total 380</span><br><span class="line">-rwxrwxrwx 1 pigudogzyy100 root 386528 Nov 11 21:10 rJava.so</span><br></pre></td></tr></table></figure>
<p>也没用</p>
<p>难过了，难道要重新安装java？版本不够？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.oracle.com/webapps/redirect/signon?nexturl=https://download.oracle.com/otn/java/jdk/11.0.17%2B10/8bd089539add49a9b99e2f27eb0c4329/jdk-11.0.17_linux-x64_bin.rpm</span><br></pre></td></tr></table></figure>
<p>要登录放弃了</p>
<p>为了解决这一问题，我们还要首先了解一下jdk和java的区别jdk是对java基础环境和相应开发平台标准和工具包的封装（zip）。</p>
<p>重新安装java：R CMD javareconf 后发现报错<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221111214135.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-17-centos ~]<span class="comment"># cd /usr/lib/jvm/</span></span><br><span class="line">[root@VM-4-17-centos jvm]<span class="comment"># ll</span></span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x 4 root root 4096 Oct 17 22:24 java-1.7.0-openjdk-1.7.0.261-2.6.22.2.el7_8.x86_64</span><br><span class="line">drwxr-xr-x 3 root root 4096 Oct 21 22:42 java-1.8.0-openjdk-1.8.0.352.b08-2.el7_9.x86_64</span><br><span class="line">lrwxrwxrwx 1 root root   21 Nov 11 21:38 jre -&gt; /etc/alternatives/jre</span><br><span class="line">lrwxrwxrwx 1 root root   27 Oct 17 22:24 jre-1.7.0 -&gt; /etc/alternatives/jre_1.7.0</span><br><span class="line">lrwxrwxrwx 1 root root   35 Oct 17 22:24 jre-1.7.0-openjdk -&gt; /etc/alternatives/jre_1.7.0_openjdk</span><br><span class="line">lrwxrwxrwx 1 root root   54 Oct 17 22:24 jre-1.7.0-openjdk-1.7.0.261-2.6.22.2.el7_8.x86_64 -&gt; java-1.7.0-openjdk-1.7.0.261-2.6.22.2.el7_8.x86_64/jre</span><br><span class="line">lrwxrwxrwx 1 root root   27 Nov 11 21:38 jre-1.8.0 -&gt; /etc/alternatives/jre_1.8.0</span><br><span class="line">lrwxrwxrwx 1 root root   35 Nov 11 21:38 jre-1.8.0-openjdk -&gt; /etc/alternatives/jre_1.8.0_openjdk</span><br><span class="line">lrwxrwxrwx 1 root root   51 Nov 11 21:38 jre-1.8.0-openjdk-1.8.0.352.b08-2.el7_9.x86_64 -&gt; java-1.8.0-openjdk-1.8.0.352.b08-2.el7_9.x86_64/jre</span><br><span class="line">lrwxrwxrwx 1 root root   29 Nov 11 21:38 jre-openjdk -&gt; /etc/alternatives/jre_openjdk</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">find java-1.7.0-openjdk-1.7.0.261-2.6.22.2.el7_8.x86_64 -name jni.h</span><br><span class="line">find java-1.8.0-openjdk-1.8.0.352.b08-2.el7_9.x86_64 -name jni.h</span><br><span class="line"># 发现根本找不到</span><br><span class="line"># 但刚才是有的，</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; remove.packages(&quot;rJava&quot;, lib=&quot;~/R/x86_64-pc-linux-gnu-library/4.2&quot;)</span><br><span class="line">&gt; install.packages(&quot;rJave&quot;)</span><br><span class="line">Installing package into ‘/home/pigudogzyy100/R/x86_64-pc-linux-gnu-library/4.2’</span><br><span class="line">(as ‘lib’ is unspecified)</span><br><span class="line">Warning in install.packages :</span><br><span class="line">  package ‘rJave’ is not available for this version of R</span><br><span class="line"></span><br><span class="line">A version of this package for your version of R might be available elsewhere,</span><br><span class="line">see the ideas at</span><br><span class="line">https://cran.r-project.org/doc/manuals/r-patched/R-admin.html#Installing-packages</span><br></pre></td></tr></table></figure>
<p>大离谱，真他妈恶心</p>
<p>算了重新安装吧,检查一下系统中的jdk版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-17-centos jvm]# cd ~/</span><br><span class="line">[root@VM-4-17-centos ~]# java -version</span><br><span class="line">openjdk version &quot;1.8.0_352&quot;</span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_352-b08)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.352-b08, mixed mode)</span><br></pre></td></tr></table></figure>

<p>检测jdk安装包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-17-centos ~]# rpm -qa | grep java</span><br><span class="line">R-java-3.6.0-1.el7.x86_64</span><br><span class="line">javapackages-tools-3.4.1-11.el7.noarch</span><br><span class="line">java-1.7.0-openjdk-headless-1.7.0.261-2.6.22.2.el7_8.x86_64</span><br><span class="line">tzdata-java-2022d-1.el7.noarch</span><br><span class="line">java-1.8.0-openjdk-1.8.0.352.b08-2.el7_9.x86_64</span><br><span class="line">python-javapackages-3.4.1-11.el7.noarch</span><br><span class="line">R-java-devel-3.6.0-1.el7.x86_64</span><br><span class="line">java-1.8.0-openjdk-headless-1.8.0.352.b08-2.el7_9.x86_64</span><br></pre></td></tr></table></figure>

<p>卸载openjdk，我们可以看到我们在删除过程中删除了R-java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-17-centos ~]# yum remove *openjdk*</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Repository epel is listed more than once in the configuration</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package java-1.7.0-openjdk-headless.x86_64 1:1.7.0.261-2.6.22.2.el7_8 will be erased</span><br><span class="line">--&gt; Processing Dependency: java-headless for package: R-java-3.6.0-1.el7.x86_64</span><br><span class="line">---&gt; Package java-1.8.0-openjdk.x86_64 1:1.8.0.352.b08-2.el7_9 will be erased</span><br><span class="line">---&gt; Package java-1.8.0-openjdk-headless.x86_64 1:1.8.0.352.b08-2.el7_9 will be erased</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package R-java.x86_64 0:3.6.0-1.el7 will be erased</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line">centos-sclo-rh/x86_64                                                                    | 3.0 kB  00:00:00     </span><br><span class="line">centos-sclo-sclo/x86_64                                                                  | 3.0 kB  00:00:00     </span><br><span class="line">epel/7/x86_64                                                                            | 4.7 kB  00:00:00     </span><br><span class="line">epel/7/x86_64/updateinfo                                                                 | 1.0 MB  00:00:00     </span><br><span class="line">epel/7/x86_64/primary_db                                                                 | 7.0 MB  00:00:00     </span><br><span class="line">extras/7/x86_64                                                                          | 2.9 kB  00:00:00     </span><br><span class="line">os/7/x86_64                                                                              | 3.6 kB  00:00:00     </span><br><span class="line">updates/7/x86_64                                                                         | 2.9 kB  00:00:00     </span><br><span class="line"></span><br><span class="line">Dependencies Resolved================================================================================================================</span><br><span class="line"> Package                             Arch           Version                              Repository        Size</span><br><span class="line">================================================================================================================</span><br><span class="line">Removing:</span><br><span class="line"> java-1.7.0-openjdk-headless         x86_64         1:1.7.0.261-2.6.22.2.el7_8           @os               95 M</span><br><span class="line"> java-1.8.0-openjdk                  x86_64         1:1.8.0.352.b08-2.el7_9              @updates         646 k</span><br><span class="line"> java-1.8.0-openjdk-headless         x86_64         1:1.8.0.352.b08-2.el7_9              @updates         110 M</span><br><span class="line">Removing for dependencies:</span><br><span class="line"> R-java                              x86_64         3.6.0-1.el7                          @epel            0.0  </span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================================================</span><br><span class="line">Remove  3 Packages (+1 Dependent package)</span><br></pre></td></tr></table></figure>

<p>再次输入 rpm -qa | grep java 查看卸载情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-17-centos ~]# rpm -qa | grep java</span><br><span class="line">javapackages-tools-3.4.1-11.el7.noarch</span><br><span class="line">tzdata-java-2022d-1.el7.noarch</span><br><span class="line">python-javapackages-3.4.1-11.el7.noarch</span><br><span class="line">R-java-devel-3.6.0-1.el7.x86_64</span><br></pre></td></tr></table></figure>

<p>找到jdk官网下载想要的jdk版本，当然在此之前我们先来查看我们的cpu指令集架构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-17-centos ~]# uname -a</span><br><span class="line">Linux VM-4-17-centos 3.10.0-1160.71.1.el7.x86_64 #1 SMP Tue Jun 28 15:37:28 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.oracle.com/java/19/latest/jdk-19_linux-x64_bin.tar.gz</span><br></pre></td></tr></table></figure>

<p>解压我们的安装包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf</span><br><span class="line"># -C  change to directory DIR</span><br><span class="line"># -z --gzip: filter the achive through gzip</span><br><span class="line"># -x --extract: extract files from an archive</span><br><span class="line"># -v --verbose: verbosely list files processed</span><br><span class="line"># -f --file=ARCHEIVE use archive file or device ARCHIVE</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/lib/jvm</span><br><span class="line"># p means parents</span><br><span class="line"></span><br><span class="line">tar -zxvf jdk-19_linux-x64_bin.tar.gz -C /usr/lib/jvm</span><br></pre></td></tr></table></figure>

<p>设置环境变量</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure>

<p>后面添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/jdk-19.0.1 </span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre  </span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib  </span><br><span class="line">export  PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221112113143.png"></p>
<p>执行profile文件 是配置不同重启既可以立即生效</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<p>在检查一遍新安装的jdk</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-17-centos ~]# java --version</span><br><span class="line">java 19.0.1 2022-10-18</span><br><span class="line">Java(TM) SE Runtime Environment (build 19.0.1+10-21)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 19.0.1+10-21, mixed mode, sharing)</span><br></pre></td></tr></table></figure>

<p>我们再试一次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-17-centos ~]# java --version</span><br><span class="line">java 19.0.1 2022-10-18</span><br><span class="line">Java(TM) SE Runtime Environment (build 19.0.1+10-21)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 19.0.1+10-21, mixed mode, sharing)</span><br><span class="line">[root@VM-4-17-centos ~]# R CMD javareconf</span><br><span class="line">Java interpreter : /usr/lib/jvm/jdk-19.0.1/bin/java</span><br><span class="line">Java version     : 19.0.1</span><br><span class="line">Java home path   : /usr/lib/jvm/jdk-19.0.1</span><br><span class="line">Java compiler    : /usr/lib/jvm/jdk-19.0.1/bin/javac</span><br><span class="line">Java headers gen.: </span><br><span class="line">Java archive tool: /usr/lib/jvm/jdk-19.0.1/bin/jar</span><br><span class="line"></span><br><span class="line">trying to compile and link a JNI program </span><br><span class="line">detected JNI cpp flags    : -I$(JAVA_HOME)/include -I$(JAVA_HOME)/include/linux</span><br><span class="line">detected JNI linker flags : -L$(JAVA_HOME)/lib/server -ljvm</span><br><span class="line">gcc -std=gnu11 -I&quot;/opt/R/4.2.1/lib/R/include&quot; -DNDEBUG -I/usr/lib/jvm/jdk-19.0.1/include -I/usr/lib/jvm/jdk-19.0.1/include/linux  -I/usr/local/include   -fpic  -g -O2  -c conftest.c -o conftest.o</span><br><span class="line">gcc -std=gnu11 -shared -L/opt/R/4.2.1/lib/R/lib -L/usr/local/lib -o conftest.so conftest.o -L/usr/lib/jvm/jdk-19.0.1/lib/server -ljvm -L/opt/R/4.2.1/lib/R/lib -lR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">JAVA_HOME        : /usr/lib/jvm/jdk-19.0.1</span><br><span class="line">Java library path: $(JAVA_HOME)/lib/server</span><br><span class="line">JNI cpp flags    : -I$(JAVA_HOME)/include -I$(JAVA_HOME)/include/linux</span><br><span class="line">JNI linker flags : -L$(JAVA_HOME)/lib/server -ljvm</span><br><span class="line">Updating Java configuration in /opt/R/4.2.1/lib/R</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sys.setenv(JAVA_HOME=&#x27;/usr/lib/jvm/jdk-19.0.1/jre/jre1.8.0_351&#x27;)</span><br></pre></td></tr></table></figure>

<p>但是我们发现没有jre这个文件夹<br>jre文件夹是运行Java程序必不可少的运行环境，比如我们在玩Java版的Minecraft时就必须配置jre的路径。通常我们给用户使用的Java程序中都需要有jre来运行，我们自己做小项目时也是需要jre的。不走运的是新版本的jdk中似乎没有jre的存在，这是因为在Java8之后在安装jdk时便不再提供jre的安装，而是让我们根据自己的需要自行的安装，接下来我会展示如何自己安装jre文件夹（以Java11为例）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-17-centos ~]# ll /usr/lib/jvm/jdk-19.0.1</span><br><span class="line">total 36</span><br><span class="line">drwxr-xr-x  2 root  root  4096 Nov 12 11:28 bin</span><br><span class="line">drwxr-xr-x  5 root  root  4096 Nov 12 11:28 conf</span><br><span class="line">drwxr-xr-x  3 root  root  4096 Nov 12 11:28 include</span><br><span class="line">drwxr-xr-x  2 root  root  4096 Nov 12 11:28 jmods</span><br><span class="line">drwxr-xr-x 72 root  root  4096 Nov 12 11:28 legal</span><br><span class="line">drwxr-xr-x  5 root  root  4096 Nov 12 11:28 lib</span><br><span class="line">lrwxrwxrwx  1 10668 10668   23 Sep 14 20:58 LICENSE -&gt; legal/java.base/LICENSE</span><br><span class="line">drwxr-xr-x  3 root  root  4096 Nov 12 11:28 man</span><br><span class="line">-rw-r--r--  1 10668 10668  290 Sep 14 20:58 README</span><br><span class="line">-rw-r--r--  1 10668 10668 1234 Sep 14 20:58 release</span><br></pre></td></tr></table></figure>

<p>注意在官网注册账号的时候，可能会出现邮箱注册等待时间较长的情况<br>官网： <a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/downloads/">https://www.oracle.com/java/technologies/downloads/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/lib/jvm/jdk-19.0.1/jre</span><br><span class="line">tar -zxvf /home/pigudogzyy100/jre-8u351-linux-i586.tar.gz -C /usr/lib/jvm/jdk-19.0.1/jre</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 777 /usr/lib/jvm </span><br><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/jdk-19.0.1</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre/jre1.8.0_351</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib</span><br><span class="line">export  PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br><span class="line"># 运行程序需要jre，开发才需要jdk，但在服务器上我们只需要jre运行程序即可。</span><br></pre></td></tr></table></figure>
<p>很好还是失败，已就报错不符合版本，淦</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 离谱</span></span><br><span class="line">BioManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&quot;rJava&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 成功了。。。。乐死我了</span></span><br><span class="line">install.package<span class="punctuation">(</span><span class="string">&quot;xlsx&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>但是报错再现，第二天我们重新打开的时候报了如下的错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; library(xlsx)</span><br><span class="line">Error: package or namespace load failed for ‘xlsx’:</span><br><span class="line"> .onLoad failed in loadNamespace() for &#x27;rJava&#x27;, details:</span><br><span class="line">  call: dyn.load(file, DLLpath = DLLpath, ...)</span><br><span class="line">  error: unable to load shared object &#x27;/home/pigudogzyy100/R/x86_64-pc-linux-gnu-library/4.2/rJava/libs/rJava.so&#x27;:</span><br><span class="line">  libjvm.so: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>

<p>我以为是权限问题，修改后还是没用<br>无语了，大家以后还是用老版本的java吧，java8及之前的都行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-17-centos ~]# R CMD javareconf</span><br><span class="line">Java interpreter : /usr/lib/jvm/jdk-19.0.1/bin/java</span><br><span class="line">Java version     : 19.0.1</span><br><span class="line">Java home path   : /usr/lib/jvm/jdk-19.0.1</span><br><span class="line">Java compiler    : /usr/lib/jvm/jdk-19.0.1/bin/javac</span><br><span class="line">Java headers gen.: </span><br><span class="line">Java archive tool: /usr/lib/jvm/jdk-19.0.1/bin/jar</span><br><span class="line"></span><br><span class="line">trying to compile and link a JNI program </span><br><span class="line">detected JNI cpp flags    : -I$(JAVA_HOME)/include -I$(JAVA_HOME)/include/linux</span><br><span class="line">detected JNI linker flags : -L$(JAVA_HOME)/lib/server -ljvm</span><br><span class="line">gcc -std=gnu11 -I&quot;/opt/R/4.2.1/lib/R/include&quot; -DNDEBUG -I/usr/lib/jvm/jdk-19.0.1/include -I/usr/lib/jvm/jdk-19.0.1/include/linux  -I/usr/local/include   -fpic  -g -O2  -c conftest.c -o conftest.o</span><br><span class="line">gcc -std=gnu11 -shared -L/opt/R/4.2.1/lib/R/lib -L/usr/local/lib -o conftest.so conftest.o -L/usr/lib/jvm/jdk-19.0.1/lib/server -ljvm -L/opt/R/4.2.1/lib/R/lib -lR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">JAVA_HOME        : /usr/lib/jvm/jdk-19.0.1</span><br><span class="line">Java library path: $(JAVA_HOME)/lib/server</span><br><span class="line">JNI cpp flags    : -I$(JAVA_HOME)/include -I$(JAVA_HOME)/include/linux</span><br><span class="line">JNI linker flags : -L$(JAVA_HOME)/lib/server -ljvm</span><br><span class="line">Updating Java configuration in /opt/R/4.2.1/lib/R</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line">[root@VM-4-17-centos ~]# $JAVA_HOME</span><br><span class="line">-bash: /usr/lib/jvm/jdk-19.0.1: Is a directory</span><br></pre></td></tr></table></figure>

<p>尝试去了解了一下&#x2F;etc&#x2F;profile, &#x2F;etc&#x2F;bashrc, ~&#x2F;.bash_profile, ~&#x2F;.bashrc 的区别</p>
<ul>
<li><p><code>/etc/profile</code>: 此文件为系统每个用户设置环境变量，当用户第一次登录时，该文件被执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># /etc/profile</span><br><span class="line"></span><br><span class="line"># System wide environment and startup programs, for login setup</span><br><span class="line"># Functions and aliases go in /etc/bashrc</span><br><span class="line"></span><br><span class="line"># It&#x27;s NOT a good idea to change this file unless you know what you</span><br><span class="line"># are doing. It&#x27;s much better to create a custom.sh shell script in</span><br><span class="line"># /etc/profile.d/ to make custom changes to your environment, as this</span><br><span class="line"># will prevent the need for merging in future updates.</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>/etc/bashrc</code>为每一个运行bash shell的用户执行此文件。当bash shell 被打开，改文件被读取</p>
</li>
<li><p>如果你想对所有使用bash的用户修改某个配置并在以后打开的bash都生效的话可以修改这个文件，修改这个文件不用重启，重新打开一个bash即可以生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># /etc/bashrc</span><br><span class="line"></span><br><span class="line"># System wide functions and aliases</span><br><span class="line"># Environment stuff goes in /etc/profile</span><br><span class="line"></span><br><span class="line"># It&#x27;s NOT a good idea to change this file unless you know what you</span><br><span class="line"># are doing. It&#x27;s much better to create a custom.sh shell script in</span><br><span class="line"># /etc/profile.d/ to make custom changes to your environment, as this</span><br><span class="line"># will prevent the need for merging in future updates.</span><br></pre></td></tr></table></figure>
</li>
<li><p>~&#x2F;.bash_profile:每个用户都可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行一次!默认情况下,他设置一些环境变量,执行用户的.bashrc文件.</p>
<ul>
<li>此文件类似于&#x2F;etc&#x2F;profile，也是需要需要重启才会生效，&#x2F;etc&#x2F;profile对所有用户生效，~&#x2F;.bash_profile只对当前用户生效。</li>
</ul>
</li>
<li><p>~&#x2F;.bashrc:该文件包含专用于你的bash shell的bash信息,当登录时以及每次打开新的shell时,该文件被读取.（每个用户都有一个.bashrc文件，在用户目录下）</p>
<ul>
<li>此文件类似于&#x2F;etc&#x2F;bashrc，不需要重启生效，重新打开一个bash即可生效，  &#x2F;etc&#x2F;bashrc对所有用户新打开的bash都生效，但~&#x2F;.bashrc只对当前用户新打开的bash生效。</li>
</ul>
</li>
<li><p><del>&#x2F;.bash_profile 是交互式、login 方式进入bash 运行的；</del>&#x2F;<strong>.bashrc</strong> 是交互式 non-login 方式进入bash 运行的；通常二者设置大致相同，所以通常前者会调用后者。</p>
</li>
</ul>
<h3 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 导入数据</span><br><span class="line">&gt; dat = read.table(&quot;BLCA_93663_50_50.csv&quot;,header=T)</span><br><span class="line">&gt; is.data.frame(dat)</span><br><span class="line">[1] TRUE</span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> is.data.frame<span class="punctuation">(</span>state.x77<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> x <span class="operator">=</span> state.abb</span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">dim</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 向量变因子</span></span><br><span class="line"><span class="operator">&gt;</span> x <span class="operator">=</span> state.babb</span><br><span class="line"><span class="operator">&gt;</span> as.factor<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 变为列表</span></span><br><span class="line"><span class="operator">&gt;</span> as.list<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 这是一个数据框</span></span><br><span class="line"><span class="operator">&gt;</span> who <span class="operator">=</span> read.csv<span class="punctuation">(</span><span class="string">&quot;WHO.csv&quot;</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> who1 <span class="operator">=</span> who<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">50</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> who2 <span class="operator">=</span> who<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">8</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span><span class="number">14</span><span class="punctuation">,</span><span class="number">16</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> who4 <span class="operator">=</span> who<span class="punctuation">[</span>which<span class="punctuation">,</span><span class="punctuation">(</span>who<span class="operator">$</span>CountryID <span class="operator">&gt;</span> <span class="number">50</span> <span class="operator">&amp;</span> who<span class="operator">$</span>CountryID <span class="operator">&lt;=</span><span class="number">100</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> who4 <span class="operator">=</span> subset<span class="punctuation">(</span>who<span class="punctuation">,</span>who<span class="operator">$</span>CountryID <span class="operator">&gt;</span> <span class="number">50</span> <span class="operator">&amp;</span> who<span class="operator">$</span>CountryID <span class="operator">&lt;=</span><span class="number">100</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>sample抽样,机器学习中抽取两份样本,一份用来建模,一份用来验证模型的有效性</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="operator">?</span>sample</span><br><span class="line"><span class="comment">## 例子,第一个参数为是选择那个向量,第二个是要抽取的个数,replace 表示是否放回式的抽样.</span></span><br><span class="line"><span class="operator">&gt;</span> x <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">100</span></span><br><span class="line"><span class="operator">&gt;</span> sample<span class="punctuation">(</span>x<span class="punctuation">,</span><span class="number">30</span><span class="punctuation">,</span>replace <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">39</span> <span class="number">23</span> <span class="number">11</span> <span class="number">26</span> <span class="number">50</span> <span class="number">86</span> <span class="number">86</span> <span class="number">71</span> <span class="number">26</span>  <span class="number">6</span> <span class="number">10</span> <span class="number">93</span> <span class="number">81</span> <span class="number">73</span> <span class="number">74</span> <span class="number">87</span> <span class="number">98</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">18</span><span class="punctuation">]</span>  <span class="number">6</span> <span class="number">17</span> <span class="number">87</span> <span class="number">10</span> <span class="number">69</span> <span class="number">51</span> <span class="number">24</span> <span class="number">22</span> <span class="number">70</span> <span class="number">33</span> <span class="number">68</span> <span class="number">97</span> <span class="number">82</span></span><br><span class="line"><span class="operator">&gt;</span> sort<span class="punctuation">(</span>sample<span class="punctuation">(</span>x<span class="punctuation">,</span><span class="number">30</span><span class="punctuation">,</span>replace <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>  <span class="number">8</span> <span class="number">19</span> <span class="number">23</span> <span class="number">23</span> <span class="number">28</span> <span class="number">31</span> <span class="number">32</span> <span class="number">40</span> <span class="number">40</span> <span class="number">42</span> <span class="number">50</span> <span class="number">50</span> <span class="number">50</span> <span class="number">51</span> <span class="number">52</span> <span class="number">55</span> <span class="number">58</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">18</span><span class="punctuation">]</span> <span class="number">60</span> <span class="number">63</span> <span class="number">70</span> <span class="number">73</span> <span class="number">77</span> <span class="number">78</span> <span class="number">83</span> <span class="number">83</span> <span class="number">84</span> <span class="number">85</span> <span class="number">89</span> <span class="number">93</span> <span class="number">96</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## USArrests是一个数据集,state.division是一个因子</span></span><br><span class="line"><span class="operator">&gt;</span> cbind<span class="punctuation">(</span>USArrests<span class="punctuation">,</span>state.division<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rbind合并行,这个比较麻烦,需要所有的列有源数据集有相同的列名</span></span><br><span class="line"><span class="comment">## 取出前20行和尾20行合并</span></span><br><span class="line"><span class="operator">&gt;</span> data1 <span class="operator">=</span> head<span class="punctuation">(</span>USArrests<span class="punctuation">,</span><span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> data2 <span class="operator">=</span> head<span class="punctuation">(</span>USArrests<span class="punctuation">,</span><span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> b <span class="operator">=</span> rbind<span class="punctuation">(</span>data1<span class="punctuation">,</span>data2<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>判断是否有重复值</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> duplicated<span class="punctuation">(</span>who<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># t 转置 transposition</span><br></pre></td></tr></table></figure>

<h2 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h2><p>数据结构</p>
<ul>
<li>数值型：数值可以用于直接结算，加减乘除</li>
<li>字符串型：可以进行连接、转换、提取等</li>
<li>逻辑型：或真或假</li>
<li>日期型等</li>
<li>向量</li>
<li>数值型：数值可以用于直接结算，加减乘除</li>
<li>字符串型：可以进行连接、转换、提取等</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> rs <span class="operator">&lt;-</span> rowSums<span class="punctuation">(</span>WorldPhones<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> cm <span class="operator">&lt;-</span> colMeans<span class="punctuation">(</span>WorldPhones<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> total <span class="operator">&lt;-</span> cbind<span class="punctuation">(</span>WorldPhones<span class="punctuation">,</span>total<span class="operator">=</span>rs<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> total2 <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>WorldPhones<span class="punctuation">,</span>meanvalue<span class="operator">=</span>cm<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 注意我们的total和meanwhile最为等号左边会变成索引名</span></span><br></pre></td></tr></table></figure>

<h3 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h3><p>在R中提供了apply系列函数<br>首先是apply()函数的用法，对数据框的每一行进行求和</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply<span class="punctuation">(</span>WorldPhones<span class="punctuation">,</span>MARGIN <span class="operator">=</span>  <span class="number">1</span><span class="punctuation">,</span>FUN <span class="operator">=</span><span class="built_in">sum</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>其中，wordphones代表要进行求和的数据集，margin是数据的维数，margin&#x3D;1代表按行，margin&#x3D;2代表按列，FUN参数代表使用的函数</p>
<p>对数据框的每一列进行求平均值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply(WorldPhones,MARGIN =  2,FUN =mean)</span><br></pre></td></tr></table></figure>

<p>对数据框的每一列进行求log值（对数值）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply(WorldPhones,MARGIN =  2,FUN =log)</span><br></pre></td></tr></table></figure>

<p>这里的 margin 可以看成是python的axis</p>
<ul>
<li>margin 页面空白，差额，边缘</li>
</ul>
<h3 id="lapply-and-sapply"><a href="#lapply-and-sapply" class="headerlink" title="lapply and sapply"></a>lapply and sapply</h3><p>lapply()函数用法与apply()函数类似，不过返回值是列表，同理，sapply()也是返回值不同，sapply()函数返回的是向量或者矩阵。</p>
<p>以state.center数据为例，该数据是列表数据：</p>
<ul>
<li>统计一下列表中元素的个数：<code>lapply(state.center,FUN = length)</code><ul>
<li>因为列表中不存在行和列，所以不需要有margin参数，返回的结果值是一个列表</li>
</ul>
</li>
<li>tapply()函数用于处理因子数据，根据因子来分组，然后根据分组来处理</li>
<li>以state.name和state.division为例，state.division作为因子数据进行分组：<ul>
<li>计算每个类型区中州的数量<code>tapply(state.name,state.division,FUN = length)</code></li>
</ul>
</li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114183746.png"></li>
</ul>
<h3 id="数据的中心化和标准化-scale"><a href="#数据的中心化和标准化-scale" class="headerlink" title="数据的中心化和标准化 scale"></a>数据的中心化和标准化 scale</h3><p>接下来是数据的中心化与标准化处理（为了消除数据量纲对数据的影响），以state.x77数据为例：</p>
<ul>
<li>数据的中心化，是指数据集中的各项数据减去数据集的均值</li>
<li>数据的标准化，是指在中心化之后再除以数据集的标准差，即数据集汇总的各项数据减去数据集的均值再除以数据集的标准差</li>
</ul>
<p>在R中可以直接使用scale()函数进行中心化和标准化的处理，当scale()函数中的两个参数都为True时，就是做中心化（center&#x3D;T）和标准化处理（scale&#x3D;T）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scale(state.x77,center = T,scale = T)</span><br></pre></td></tr></table></figure>
<p>经过中心化和标准化处理过后的数据，在绘制heatmap时会比较精确，对比性比较强。</p>
<h3 id="reshape2"><a href="#reshape2" class="headerlink" title="reshape2"></a>reshape2</h3><p>假设有x，y两个数据框数据如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>k1<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span><span class="literal">NA</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span>k2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="literal">NA</span><span class="punctuation">,</span><span class="literal">NA</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span>data<span class="operator">=</span><span class="number">1</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">y <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>k1<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="literal">NA</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span>k2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span><span class="literal">NA</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span>data<span class="operator">=</span><span class="number">1</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114184025.png"></p>
<p>使用merge()函数可以根据一个或多个共有的变量来进行合并，合并两组数据中共有变量列中相同的行</p>
<ul>
<li>以k1作为共有变量合并：<code>merge(x,y,by = &quot;k1&quot;)</code><ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114184240.png"></li>
</ul>
</li>
<li>以k2作为共有变量合并，并排除有NA的情况：<code>merge(x,y,by = &quot;k2&quot;,incomparables = NA)</code><ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114184321.png"></li>
</ul>
</li>
</ul>
<p>reshape2包是一个重构和整合数据的万能工具，可以把数据转化成任何想要的形式</p>
<ul>
<li>使用airquality数据为例：首先，为了输入方便，使用toloower()函数将列名改写成小写<code>names(airquality) &lt;- tolower(names(airquality))</code><ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114184748.png"></li>
</ul>
</li>
<li>然后可以使用melt()函数融合数据，融合之后，每一行都是唯一的标识符~变量的组合：<code>aql &lt;- melt(airquality)</code>也即是将宽数据变成长数据的过程<ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114184801.png" alt="200"></li>
</ul>
</li>
<li>Id参数是用于告诉melt()函数哪一行或者那一列用作观测，而剩余的数据作为观测值<code>aql &lt;- melt(airquality,id.vars = c(&#39;month&#39;,&#39;day&#39;))</code><ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114185038.png"></li>
</ul>
</li>
</ul>
<p>数据的重构使用dcast()或者acast()函数，处理数据框使用dcast()函数，acast()函数处理向量、矩阵或者数组：</p>
<ul>
<li>Formula参数用于描述数据的形状，“~”在R中代表两者相关联，用以下代码即可重构数据<code>aqw &lt;- dcast(aql,month+day ~variable)</code></li>
<li>也可以只重构数据，并对日数据求平均值，求一个月的平均值，还可以使用na.rm()去除缺失值：<code>aqw &lt;- dcast(aql,formula = month ~variable,fun.aggregate = mean,na.rm=TRUE)</code><ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114185657.png"></li>
</ul>
</li>
</ul>
<h3 id="tidyr-包的使用"><a href="#tidyr-包的使用" class="headerlink" title="tidyr 包的使用"></a>tidyr 包的使用</h3><p>Tidyr数据是一种很简洁的数据，数据的每一列代表一个变量，每一行代表一个观测，每一个观测的值在表中为一个单元格，也就是一个观测一个变量确定唯一的一个值。</p>
<p>接下来使用mtcars的数据来介绍一下tidyr包的函数用法</p>
<ul>
<li>Mtcars数据是很典型的一个tidyr数据，先取数据的10行和3列，赋值到一个新的变量上。<ul>
<li><code>tdata &lt;- mtcars[1:10,1:3]</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114185933.png" alt="200"></li>
</ul>
</li>
<li>取数据的行名生成新的一个数据框（方便处理）<code>tdata &lt;- data.frame(names=rownames(tdata),tdata)</code><ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114190130.png" alt="300"></li>
</ul>
</li>
</ul>
<p>gather函数：</p>
<ul>
<li>gather（data,key,value…..），data参数是要处理的数据，key参数是宽数据变为长数据时，存放需要编码的变量的变量名称，需要自己定义，value参数是需要数据转换的变量的名称，也需要自己定义。</li>
<li><code>gather(tdata,key = &#39;key&#39;,value = &#39;value&#39;,cyl,disp,mpg)</code><ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114190442.png"></li>
</ul>
</li>
<li>可以使用冒号，制定多列聚到同一列中，此处是将cyl与mpg先输出，然后在和disp组成一个数据框<code>gather(tdata,key = &#39;key&#39;,value = &#39;values&#39;,cyl:mpg,disp)</code></li>
<li>也可以直接使用列的索引编号进行数据的重新构造<code>gather(tdata,key = &#39;key&#39;,value = &#39;value&#39;,2:4)</code></li>
<li>如果该在列名称前添加一个负号，代表不需要转换该列<code>-disc</code></li>
</ul>
<p>Spread函数则是将合并数据转化成tidyr形式的数据</p>
<ul>
<li>例如，对之前合并的tdata函数进行分开：<code>gdata &lt;- gather(tdata,key=&#39;key&#39;,value = &#39;value&#39;,2:4)</code><ul>
<li><code>spread(gdata,key = &#39;key&#39;,value=&quot;value&quot;)</code>就可以还原数据</li>
</ul>
</li>
</ul>
<h3 id="dplyr-包"><a href="#dplyr-包" class="headerlink" title="dplyr 包"></a>dplyr 包</h3><p>使用iris数据对dplyr包的用法做介绍，首先是filter函数</p>
<ul>
<li>可以使用filter函数用指定条件对数据进行筛选，比如以下代码可以筛选掉花萼长度在7以下的数据，保留在7以上的数据<code>dplyr::filter(iris,Sepal.Length&gt;7)</code><ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114191602.png"></li>
</ul>
</li>
<li>distinct函数可以用于去除重复行，相当于unique函数的功能<ul>
<li>比如，可以使用rbind函数合并iris数据集的1-10行数据与1-15行数据，再使用第三条函数去除多余行<code>dplyr::distinct(rbind(iris[1:10,],iris[1:15,]))</code></li>
<li>以上代码的运行结果只会保留，10-15行的数据，因为1-10行数据是重复的</li>
</ul>
</li>
<li>Slice函数可以用于切片，可以取出数据的任意行<ul>
<li><code>dplyr::slice(iris,10:15)</code>以上代码可以取出iris数据的10-15</li>
</ul>
</li>
<li>Sample_n函数用于随机取样，<ul>
<li>例如<code>dplyr::sample_n(iris,10)</code>代表在iris这个数据中随机抽取10行</li>
</ul>
</li>
<li>Sample_frac表示按比例随机选取，比如抽取源数据的10%的数据，是指百分比：<ul>
<li><code>dplyr::sample_frac(iris,0.1)</code></li>
</ul>
</li>
<li>arrange函数用于排序，比如将iris数据按照花萼长度进行排序（正向），可写成：<ul>
<li>dplyr::arrange(iris,Sepal.Length)&#96;</li>
<li>如果加上前面负号则是进行反向排序（从大到小）<code>dplyr::arrange(iris,-Sepal.Length)</code></li>
</ul>
</li>
</ul>
<p>关于dplyr的统计函数：</p>
<ul>
<li>可以使用summarise()函数进行统计，比如统计花萼长度的平均值：<ul>
<li><code>summarise(iris,avg=mean(Sepal.Length))</code></li>
</ul>
</li>
<li>统计花萼长度的和：<code>summarise(iris,total=sum(Sepal.Length))</code></li>
</ul>
<p>R中一个非常有用的负号：**%&gt;%** 这个符号是链式操作符，它的功能是用于实现将一个函数的输出传递给下一个函数，作为下一个函数的输入，在键盘上可以用Ctrl+shift+M的快捷键打出来，有点类似于“且”的概念。</p>
<ul>
<li><p>比如，先使用head函数取出数据集的前20行，再使用链式操作符，可以将这20行数据作为下一个命令的输入</p>
</li>
<li><p>如下一个命令是tail（10），也就是取出倒数10行，那么就会取出这20行数据的第11-20行：</p>
<ul>
<li><code>head(mtcars,3)</code><ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114192232.png"></li>
</ul>
</li>
<li><code>head(mtcars,3) %&gt;% tail(1)</code><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114192323.png"></li>
</ul>
</li>
<li><p>Group_by函数可以对数据进行分组，例如根据species这列对数据进行分组：</p>
<ul>
<li>如果用链式操作符，代码可以改为：<ul>
<li><code>iris %&gt;% group_by(Species)</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114192734.png"></li>
</ul>
</li>
<li>还可以结合summarize统计函数进行进一步的计算，例如可以计算每一种类型鸢尾花品种的花萼宽度的平均值：<ul>
<li><code>iris %&gt;% dplyr::group_by(Species) %&gt;% dplyr::summarise(avg=mean(Sepal.Width))</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114193027.png"></li>
</ul>
</li>
<li>在此基础上，还可以使用链式操作符，对宽度的平均值进行排序：<ul>
<li><code>iris %&gt;% group_by(Species) %&gt;% summarise(avg=mean(Sepal.Width)) %&gt;% arrange(avg)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>mutate 函数可以添加新的变量</p>
<ul>
<li>使用mutate函数在iris数据中增加一行，该行数据是花萼与花瓣长度的总和<ul>
<li><code>dplyr::mutate(iris,new=Sepal.Length+Petal.Length)</code></li>
</ul>
</li>
</ul>
<p>下面介绍一下的dplyr包对于双表格的操作：</p>
<ul>
<li>比如将两个表格整合到一起，先创建两个数据框，分别是a,b<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a<span class="operator">=</span>data.frame<span class="punctuation">(</span>x1<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;B&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;C&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span>x2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">b<span class="operator">=</span>data.frame<span class="punctuation">(</span>x1<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;B&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;D&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span>x2<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">T</span><span class="punctuation">,</span><span class="built_in">F</span><span class="punctuation">,</span><span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></li>
<li>首先是左连接，left_join()，以x1列为基础进行连接<code>dplyr::left_join(a,b,by=&quot;x1&quot;)</code><ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114193157.png"></li>
</ul>
</li>
<li>然后是右连接，<code>right_join()</code>，是以b的x1列为基础进行连接<ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114193247.png"></li>
</ul>
</li>
<li>然后是内连接和全连接，内连接是取x1的交集，全连接是取x1的并集<ul>
<li>内连接：<ul>
<li><code>dplyr::inner_join(a,b,by=&quot;x1&quot;)</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114193558.png"></li>
</ul>
</li>
<li>全连接：<ul>
<li><code>dplyr::full_join(a,b,by=&quot;x1&quot;)</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114193621.png"></li>
</ul>
</li>
</ul>
</li>
<li>半连接相当于根据右侧表的内容对左侧表进行过滤，也就是将两个表的数据的交集取出来：<ul>
<li>半连接：<ul>
<li><code>dplyr::semi_join(a,b,by=&quot;x1&quot;)</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114193646.png"></li>
</ul>
</li>
</ul>
</li>
<li>反连接是输出两个表的补集部分，也就是取出数据框a中b不含有的行：<ul>
<li><code>dplyr::anti_join(a,b,by=&quot;x1&quot;)</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114193713.png"></li>
</ul>
</li>
<li>以上两个函数是互补的函数，一个是取共有的，一个是取没有的。</li>
</ul>
<p>下面来看几个数据框的合并操作</p>
<ul>
<li>首先定义数据first变量，变量取mtcars数据前20行，second变量取第10-30行，由于slice函数取出的数据不含行名，需要在取出数据前用mutate函数添加一列行名<ul>
<li><code>mtcars &lt;- mutate(mtcars,names=row.names(mtcars))</code></li>
<li><code>first &lt;- slice(mtcars,1:20)</code></li>
<li><code>second &lt;- slice(mtcars,10:30)</code></li>
</ul>
</li>
<li>然后验证函数<ul>
<li>Intersect()取交集：<ul>
<li><code>intersect(first,second)</code></li>
</ul>
</li>
<li>Union_all()取并集：<ul>
<li><code>dplyr::union_all(first,second)</code></li>
</ul>
</li>
<li>Union()取非冗余的并集，去除掉重复部分再进行合并：<ul>
<li><code>dplyr::union(first,second)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>setdiff()取数据的补集，也就是取出frist数据中second数据没有的部分：</p>
<ul>
<li><code>setdiff(first,second)</code></li>
</ul>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="intro-of-function-in-R"><a href="#intro-of-function-in-R" class="headerlink" title="intro of function in R"></a>intro of function in R</h3><p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114194015.png"><br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114194039.png"><br>一般函数的选项参数可以分成三个部分：<em>输入控制部分</em>；<em>输出控制部分</em>；<em>调节部分</em></p>
<p><strong>输入控制部分</strong>负责告诉用户函数能接受哪种类型的数据，这个选项参数往往出现在函数的第一位，比如说，有些函数的第一位选项参数是“file”说明使用这个函数你需要输入一个文件；如果是“data”则是需要输入一个数据框；“x”代表单独的一个对象，一般都是向量，也可以是矩阵或者列表；“x和y”代表函数需要两个输入变量；“x、y、z”函数需要三个输入变量；“formula”输入的是公式；（具体查看每个函数的帮助文档）</p>
<p><strong>输出控制部分</strong></p>
<p>**调节参数<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114194130.png"><br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114194138.png"></p>
<h3 id="数学统计函数"><a href="#数学统计函数" class="headerlink" title="数学统计函数"></a>数学统计函数</h3><h4 id="概率函数"><a href="#概率函数" class="headerlink" title="概率函数"></a>概率函数</h4><p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114194437.png"></p>
<p>概率论是统计学的基础，R有许多用于处理概率，概率分布以及随机变量的函数，R对每一个概率分布都有一个简称，这个名称用于识别与分布相联系的函数，这部分涉及到很多统计学基础的理论知识，比如随机试验、样本空间、对立与互斥、随机事件与必然事件、概率密度、概率分布等。</p>
<p>R中的概率函数（正态分布）：</p>
<ul>
<li>d前缀—概率密度函数；P前缀—概率分布函数；q前缀—分位数函数（分布函数的反函数）；r前缀—产生相同分布的随机数，Norm表示正态分布</li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114194558.png"></li>
<li><code>rnorm(n=100,mean = 15,sd=2)</code><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> rnorm<span class="punctuation">(</span>n<span class="operator">=</span><span class="number">100</span><span class="punctuation">,</span>mean <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span>sd<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">17.148571</span> <span class="number">12.157482</span> <span class="number">15.141314</span> <span class="number">18.296570</span> <span class="number">12.137872</span> <span class="number">16.747959</span> <span class="number">12.938258</span> <span class="number">13.613192</span> <span class="number">16.013074</span> <span class="number">16.719560</span> <span class="number">17.494545</span> <span class="number">13.793703</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">13</span><span class="punctuation">]</span> <span class="number">11.070693</span> <span class="number">12.799771</span> <span class="number">15.993014</span> <span class="number">14.940019</span> <span class="number">14.712653</span> <span class="number">13.598157</span> <span class="number">13.272777</span> <span class="number">17.248941</span>  <span class="number">9.931717</span> <span class="number">14.778654</span> <span class="number">17.081076</span> <span class="number">16.683393</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">25</span><span class="punctuation">]</span> <span class="number">15.535898</span> <span class="number">17.686197</span> <span class="number">14.588068</span> <span class="number">13.543749</span> <span class="number">11.185034</span> <span class="number">16.677925</span> <span class="number">12.887325</span> <span class="number">14.408051</span> <span class="number">13.423487</span> <span class="number">12.009116</span> <span class="number">13.682694</span> <span class="number">17.631150</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">37</span><span class="punctuation">]</span> <span class="number">15.160085</span> <span class="number">17.289744</span> <span class="number">16.250473</span> <span class="number">13.903411</span> <span class="number">12.580030</span> <span class="number">15.731931</span> <span class="number">14.529354</span> <span class="number">12.700093</span> <span class="number">16.857728</span> <span class="number">13.009733</span> <span class="number">16.140700</span> <span class="number">14.089016</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">49</span><span class="punctuation">]</span> <span class="number">14.037168</span> <span class="number">18.698976</span> <span class="number">17.197261</span> <span class="number">12.066187</span> <span class="number">19.184527</span> <span class="number">16.679644</span> <span class="number">12.899174</span> <span class="number">11.919899</span> <span class="number">18.311235</span> <span class="number">10.424975</span> <span class="number">17.053284</span> <span class="number">17.523239</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">61</span><span class="punctuation">]</span> <span class="number">15.270684</span> <span class="number">11.139295</span> <span class="number">13.633952</span> <span class="number">12.955304</span> <span class="number">10.962979</span> <span class="number">12.327804</span> <span class="number">14.329523</span> <span class="number">12.588998</span> <span class="number">14.646200</span> <span class="number">15.352163</span> <span class="number">13.588119</span> <span class="number">17.483630</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">73</span><span class="punctuation">]</span> <span class="number">13.442637</span> <span class="number">15.539610</span> <span class="number">17.879686</span> <span class="number">15.434528</span> <span class="number">15.594388</span> <span class="number">13.856813</span> <span class="number">14.549906</span> <span class="number">12.543248</span> <span class="number">15.111959</span> <span class="number">14.113847</span> <span class="number">14.972857</span> <span class="number">14.595530</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">85</span><span class="punctuation">]</span> <span class="number">15.437873</span> <span class="number">16.042588</span> <span class="number">11.817685</span> <span class="number">14.350406</span> <span class="number">12.222436</span> <span class="number">12.010179</span> <span class="number">15.746834</span> <span class="number">12.966339</span> <span class="number">19.879389</span> <span class="number">15.550835</span> <span class="number">15.262243</span> <span class="number">16.934416</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">97</span><span class="punctuation">]</span> <span class="number">12.812796</span> <span class="number">14.931907</span> <span class="number">14.134759</span> <span class="number">12.248439</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>随机数的产生</strong><br>最简单的是runif()函数，可以生成0-1之间的随机数</p>
<ul>
<li>生成50个0-1之间的随机数<ul>
<li><code>runif(50)</code></li>
</ul>
</li>
<li>如果想生成0-1之外的随机数，可以通过修改选项参数来更改<ul>
<li><code>runif(50,min=1,max = 100)</code></li>
<li>这样就能生成1-100以内的随机数了</li>
</ul>
</li>
<li>Set.seed()函数可以绑定随机数，当输入Set.seed()函数时，回到最初的随机数</li>
</ul>
<h4 id="描述性统计函数"><a href="#描述性统计函数" class="headerlink" title="描述性统计函数"></a>描述性统计函数</h4><p>首先是summary()函数，运行一次该函数，就可以对数据进行详细的统计。</p>
<ul>
<li>先自定义一个变量，把mtcars的数据赋值给这个变量：<ul>
<li><code>myvars &lt;- mtcars[c(&quot;mpg&quot;,&#39;hp&#39;,&#39;wt&#39;,&#39;am&#39;)]</code></li>
</ul>
</li>
<li>使用summary()函数计算变量的数据，结果包括最小值，最大值，四分位数和数值型变量的均值。<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> summary<span class="punctuation">(</span>myvars<span class="punctuation">)</span></span><br><span class="line">      mpg              hp              wt              am        </span><br><span class="line"> Min.   <span class="operator">:</span><span class="number">10.40</span>   Min.   <span class="operator">:</span> <span class="number">52.0</span>   Min.   <span class="operator">:</span><span class="number">1.513</span>   Min.   <span class="operator">:</span><span class="number">0.0000</span>  </span><br><span class="line"> <span class="number">1</span>st Qu.<span class="operator">:</span><span class="number">15.43</span>   <span class="number">1</span>st Qu.<span class="operator">:</span> <span class="number">96.5</span>   <span class="number">1</span>st Qu.<span class="operator">:</span><span class="number">2.581</span>   <span class="number">1</span>st Qu.<span class="operator">:</span><span class="number">0.0000</span>  </span><br><span class="line"> Median <span class="operator">:</span><span class="number">19.20</span>   Median <span class="operator">:</span><span class="number">123.0</span>   Median <span class="operator">:</span><span class="number">3.325</span>   Median <span class="operator">:</span><span class="number">0.0000</span>  </span><br><span class="line"> Mean   <span class="operator">:</span><span class="number">20.09</span>   Mean   <span class="operator">:</span><span class="number">146.7</span>   Mean   <span class="operator">:</span><span class="number">3.217</span>   Mean   <span class="operator">:</span><span class="number">0.4062</span>  </span><br><span class="line"> <span class="number">3</span>rd Qu.<span class="operator">:</span><span class="number">22.80</span>   <span class="number">3</span>rd Qu.<span class="operator">:</span><span class="number">180.0</span>   <span class="number">3</span>rd Qu.<span class="operator">:</span><span class="number">3.610</span>   <span class="number">3</span>rd Qu.<span class="operator">:</span><span class="number">1.0000</span>  </span><br><span class="line"> Max.   <span class="operator">:</span><span class="number">33.90</span>   Max.   <span class="operator">:</span><span class="number">335.0</span>   Max.   <span class="operator">:</span><span class="number">5.424</span>   Max.   <span class="operator">:</span><span class="number">1.0000</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>Fivenum()函数和summary()函数类似，但可以返回5个基本的统计量，包括最小值，四分位数、中位数、上四位数、最大值, 这里使用了$符取出单个数据列进行统计。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> fivenum<span class="punctuation">(</span>mtcars<span class="operator">$</span>hp<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>  <span class="number">52</span>  <span class="number">96</span> <span class="number">123</span> <span class="number">180</span> <span class="number">335</span></span><br></pre></td></tr></table></figure>


<p>Hmisc包中的describe()函数也可以计算统计量，可以返回变量和观测的数量、缺失值和唯一值的数目、以及平均值、分位数、已经五个最大的值和五个最小的值</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">describe<span class="punctuation">(</span>mtcars<span class="operator">$</span>hp<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116161119.png"></p>
<p>pastecs包中有一个stat.desc()函数可以计算种类繁多的描述性统计量，stat.desc()函数的选项参数中，x是一个数据框或者是时间序列</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">install.packages<span class="punctuation">(</span><span class="string">&quot;pastecs&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>pastecs<span class="punctuation">)</span></span><br><span class="line">stat.desc<span class="punctuation">(</span>mtcars<span class="operator">$</span>hp<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116161800.png"><br>如果设置base选项等于true，那么就会计算一些基本值，包括全部值的数量、空值以及缺失值的数量、最小值、最大值、值域、还有总和</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stat.desc<span class="punctuation">(</span>myvars<span class="punctuation">,</span>basic <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>如果设置desc选项等于true，那么就会计算一些描述值，包括中位数、平均数、平均数的标准误、平均置信度为95%的置信空间、方差、标准差、以及变异系数等</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> stat.desc<span class="punctuation">(</span>myvars<span class="punctuation">,</span>desc <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>默认情况下，两个选项参数都是T</p>
<p>如果设置norm为T，那么就会计算一些统计值，包括正态分布统计量、偏度和峰度等</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stat.desc<span class="punctuation">(</span>mtcars<span class="operator">$</span>hp<span class="punctuation">,</span>norm <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116161959.png"></p>
<p>psych包中也有一个describe()函数，可以计算非缺失值的数量、平均数、标准差、中位数、截尾的均值、最大值、最小值、偏度和峰度等等内容<br>截尾的均值是去掉两头的数据取均值，就像打分时，去掉一个最低分、去掉一个最高分，然后中间数据求均值。<br>describe()函数可以通过设置trim参数，设置去除比例，如trim&#x3D;0.1，则是去除数据中最高和最低的10%的部分<br>当两个包的函数名一样时，后面载入的包的函数会覆盖前面载入的包的函数，如果要使用前面一个包的函数，只需要在包后加冒号再使用即可，如：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hmisc<span class="operator">::</span>describe<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>Aggregate()函数可对数据进行分组描述，能够对数据按照指定的分组信息进行统计，将分组信息通过一个列表指定出来即可<br>例如我们使用mass这个包中的cars93数据集【93年许多不同汽车的指标】</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> library<span class="punctuation">(</span>MASS<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>以制造商这一列数据为例，</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aggregate<span class="punctuation">(</span>Cars93<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Min.Price&quot;</span><span class="punctuation">,</span><span class="string">&quot;Max.Price&quot;</span><span class="punctuation">,</span><span class="string">&quot;MPG.city&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span>by<span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span>Manufacturer<span class="operator">=</span>Cars93<span class="operator">$</span>Manufacturer<span class="punctuation">)</span><span class="punctuation">,</span>mean<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>这样就是根据汽车制造商来对数据进行分组统计，计算每个汽车制造商产品平均的价格<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116162902.png"></p>
<p>还可以根据产地：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aggregate<span class="punctuation">(</span>Cars93<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Min.Price&quot;</span><span class="punctuation">,</span><span class="string">&quot;Max.Price&quot;</span><span class="punctuation">,</span><span class="string">&quot;MPG.city&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span>by<span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span>origin<span class="operator">=</span>Cars93<span class="operator">$</span>Origin<span class="punctuation">)</span><span class="punctuation">,</span>mean<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>还可以将mean函数替换成其他函数，比如sd，计算数据的标准差</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aggregate<span class="punctuation">(</span>Cars93<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Min.Price&quot;</span><span class="punctuation">,</span><span class="string">&quot;Max.Price&quot;</span><span class="punctuation">,</span><span class="string">&quot;MPG.city&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span>by<span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span>origin<span class="operator">=</span>Cars93<span class="operator">$</span>Origin<span class="punctuation">)</span><span class="punctuation">,</span>sd<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>也可以一次性使用多个分组条件，只需要在列表中添加即可，例如同时使用产地和制造商来分组：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aggregate<span class="punctuation">(</span>Cars93<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Min.Price&quot;</span><span class="punctuation">,</span><span class="string">&quot;Max.Price&quot;</span><span class="punctuation">,</span><span class="string">&quot;MPG.city&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span>by<span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span>origin<span class="operator">=</span>Cars93<span class="operator">$</span>Origin<span class="punctuation">,</span>Manufacturer<span class="operator">=</span>Cars93<span class="operator">$</span>Manufacturer<span class="punctuation">)</span><span class="punctuation">,</span>mean<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116162934.png"></p>
<p>aggregate函数的缺点是一次只用使用一个统计函数，比如只能返回平均值、方差等，可以使用一些扩展包来进行分组计算并实现返回多种描述性统计量</p>
<p>首先是doBy包中的summaryBy()函数，summary_by(data, formula,id &#x3D; NULL,FUN &#x3D; mean..)<br>在波浪线左侧是需要分析的数值型变量，直接写数据框中的列的名字就可以，不需要添加引号；不同变量之间用+号表示；右侧的变量是类别型的分组变量；data参数指定数据集，fun参数指定统计函数，也可以是自定义函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">summaryBy<span class="punctuation">(</span>mpg<span class="operator">+</span>hp<span class="operator">+</span>wt<span class="operator">~</span>am<span class="punctuation">,</span>data<span class="operator">=</span>myvars<span class="punctuation">,</span>FUN <span class="operator">=</span> mean<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116163152.png"><br>Fun参数后面可以接多个统计函数，如</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">summaryBy<span class="punctuation">(</span>mpg<span class="operator">+</span>hp<span class="operator">+</span>wt<span class="operator">~</span>am<span class="punctuation">,</span>data<span class="operator">=</span>myvars<span class="punctuation">,</span>FUN <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>mean<span class="punctuation">,</span>sd<span class="punctuation">,</span><span class="built_in">sum</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116163213.png"></p>
<p>psych包中的describe.by()函数和describe()函数能够计算相同的统计量，但是describe.by()函数可以通过分组来计算，只需要添加一个分组的列表，直接给定一个list即可：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">describeBy<span class="punctuation">(</span>mtcars<span class="punctuation">,</span><span class="built_in">list</span><span class="punctuation">(</span>am<span class="operator">=</span>mtcars<span class="operator">$</span>am<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>describe.by()适合详细查看每一个分组的统计值，但缺点是给出的统计值是固定不变的，没办法使用自定义的函数<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116163656.png"></p>
<h4 id="频数统计函数"><a href="#频数统计函数" class="headerlink" title="频数统计函数"></a>频数统计函数</h4><p>频数在数据分析中是非常重要的一个概念，因为经常需要进行分组统计，比较不同组之间的差异，这些都要涉及到频数的统计。因子是专门用来进行分组的，有因子才能分组，分组之后才能进行频数统计。</p>
<p>首先介绍一下R如何对数据进行分组：</p>
<ul>
<li>如果一个数据本身就是因子，那么直接就可以进行分组，例如mtcars数据集，里面的“cyl”这一列数据直接就可以作为因子，依据气缸数的不同来进行分组。</li>
<li>用as.factor()函数将这列转换为因子数据：<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cylfactors <span class="operator">&lt;-</span> as.factor<span class="punctuation">(</span>mtcars<span class="operator">$</span>cyl<span class="punctuation">)</span></span><br></pre></td></tr></table></figure></li>
<li>然后可以使用split()函数对数据进行分组：<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myvars <span class="operator">&lt;-</span> dplyr<span class="operator">::</span>mutate<span class="punctuation">(</span>mtcars<span class="punctuation">,</span>cylfactors1<span class="operator">=</span>cylfactors<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116163945.png"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">split<span class="punctuation">(</span>myvars<span class="punctuation">,</span>myvars<span class="operator">$</span>cylfactors1<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116164031.png"></li>
<li>还可以使用cut()函数（如果没有明显的分类），cut可以对连续的数据进行切割，使用cut()函数对“mpg”这列进行分割，根据10-50切成10份，就是以步长为10，每十下一切：<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cut<span class="punctuation">(</span>myvars<span class="operator">$</span>mpg<span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span><span class="number">50</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 此处seq()函数的选项参数是：seq(from=，to=，by=组距)</span></span><br></pre></td></tr></table></figure>
<img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116164203.png"></li>
<li>在分组之后，就可以用table()函数进行频数的统计，table()函数可以计算频数表。<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># table()函数的使用比较简单：</span></span><br><span class="line"><span class="operator">&gt;</span> table<span class="punctuation">(</span>myvars<span class="operator">$</span>cylfactors1<span class="punctuation">)</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">6</span>  <span class="number">8</span> </span><br><span class="line"><span class="number">11</span>  <span class="number">7</span> <span class="number">14</span></span><br></pre></td></tr></table></figure></li>
<li>cut()函数的结果也可以使用table()来统计：<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> table<span class="punctuation">(</span>cut<span class="punctuation">(</span>myvars<span class="operator">$</span>mpg<span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span><span class="number">50</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span><span class="number">20</span><span class="punctuation">]</span> <span class="punctuation">(</span><span class="number">20</span><span class="punctuation">,</span><span class="number">30</span><span class="punctuation">]</span> <span class="punctuation">(</span><span class="number">30</span><span class="punctuation">,</span><span class="number">40</span><span class="punctuation">]</span> <span class="punctuation">(</span><span class="number">40</span><span class="punctuation">,</span><span class="number">50</span><span class="punctuation">]</span> </span><br><span class="line">     <span class="number">18</span>      <span class="number">10</span>       <span class="number">4</span>       <span class="number">0</span></span><br></pre></td></tr></table></figure>
以上就是频数统计的做法</li>
</ul>
<p>用频数除以总数就是频率值，R中可以直接使用prop.table()函数计算频率值：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prop.table<span class="punctuation">(</span>table<span class="punctuation">(</span>myvars<span class="operator">$</span>cylfactors1<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>问题又来了，我们应该怎么对于二维的数据框进行频率统计呢？<br>可以使用table()或者是as.table()函数，选项参数输入两个因子就可以计算二维数据的频率了。</p>
<p>这里我们以vcd包中的风湿病数据集（arthritis）进行示范。</p>
<ul>
<li>Arthritis数据集中的“treatment”、“sex”以及“improved”列都可以作为因子数据，因为它们是类型量，我们取两个作统计：<code>table(Arthritis$Treatment,Arthritis$Improved)</code></li>
<li>返回的结果是一个二维的列联表，横向是安慰剂组与治疗组的区分，每一列分别是“没有效果”、“有一些效果”、“很有效果”的区分：<ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116164652.png"></li>
</ul>
</li>
</ul>
<p>如果变量太多，我们也可以先使用with()或者是attach()函数先加载数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">with<span class="punctuation">(</span>data <span class="operator">=</span> Arthritis<span class="punctuation">,</span>table<span class="punctuation">(</span>Treatment<span class="punctuation">,</span>Improved<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>这样就不用反复的书写变量名称<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116164828.png"></p>
<p>处理二维列联表还可以使用xtabs()函数，这个函数的好处是它的选项参数使用的是formula参数，这样就可以根据需要写成多种公式。<br>同样是“treatment”以及“improved”列，使用xtabs()函数计算如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> xtabs<span class="punctuation">(</span><span class="operator">~</span> Treatment<span class="operator">+</span>Improved<span class="punctuation">,</span>data <span class="operator">=</span> Arthritis<span class="punctuation">)</span></span><br><span class="line">         Improved</span><br><span class="line">Treatment None Some Marked</span><br><span class="line">  Placebo   <span class="number">29</span>    <span class="number">7</span>      <span class="number">7</span></span><br><span class="line">  Treated   <span class="number">13</span>    <span class="number">7</span>     <span class="number">21</span></span><br></pre></td></tr></table></figure>
<p>formula参数是可以省略的，结果和with()函数的一致</p>
<p>对于二维列联表我们还可以使用margin.table()和prop.table()函数分别计算<strong>边际频数与比例（边际频率）</strong>，边际频数的意思就是单独按照行或者列的数据进行处理。<br>我们将xtabs()的结果保存到变量x中，再使用margin.table()函数统计一下x:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x <span class="operator">&lt;-</span> xtabs<span class="punctuation">(</span><span class="operator">~</span> Treatment<span class="operator">+</span>Improved<span class="punctuation">,</span>data <span class="operator">=</span> Arthritis<span class="punctuation">)</span></span><br><span class="line">margin.table<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>返回值只有一个，代表返回的是所有的结果，这里需要给定一个边际值，1或者2,1代表行，2代表列：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> margin.table<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">84</span></span><br><span class="line"><span class="operator">&gt;</span> margin.table<span class="punctuation">(</span>x<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">Treatment</span><br><span class="line">Placebo Treated </span><br><span class="line">     <span class="number">43</span>      <span class="number">41</span></span><br></pre></td></tr></table></figure>
<p>使用prop.table()函数计算比例（边际频率）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> prop.table<span class="punctuation">(</span>x<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">         Improved</span><br><span class="line">Treatment      None      Some    Marked</span><br><span class="line">  Placebo <span class="number">0.6744186</span> <span class="number">0.1627907</span> <span class="number">0.1627907</span></span><br><span class="line">  Treated <span class="number">0.3170732</span> <span class="number">0.1707317</span> <span class="number">0.5121951</span></span><br></pre></td></tr></table></figure>
<p>从边际和比例的计算结果可以看出，有治疗组有51%的比例是效果显著的.</p>
<p>再将margin.table()参数换成2，则是按列进行统计</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">margin.table<span class="punctuation">(</span>x<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>addmargin()函数可以直接将边际的和添加到频数表中</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addmargins<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> margin.table<span class="punctuation">(</span>x<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">Improved</span><br><span class="line">  None   Some Marked </span><br><span class="line">    <span class="number">42</span>     <span class="number">14</span>     <span class="number">28</span> </span><br><span class="line"><span class="operator">&gt;</span> addmargins<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">         Improved</span><br><span class="line">Treatment None Some Marked Sum</span><br><span class="line">  Placebo   <span class="number">29</span>    <span class="number">7</span>      <span class="number">7</span>  <span class="number">43</span></span><br><span class="line">  Treated   <span class="number">13</span>    <span class="number">7</span>     <span class="number">21</span>  <span class="number">41</span></span><br><span class="line">  Sum       <span class="number">42</span>   <span class="number">14</span>     <span class="number">28</span>  <span class="number">84</span></span><br></pre></td></tr></table></figure>

<p>这个函数也可单独计算行、列</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">addmargins<span class="punctuation">(</span>x<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">addmargins<span class="punctuation">(</span>x<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>我们也可以计算三维的列联表，加多一个参数就可以：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> xtabs<span class="punctuation">(</span><span class="operator">~</span> Treatment<span class="operator">+</span>Improved<span class="operator">+</span>Sex<span class="punctuation">,</span>data <span class="operator">=</span> Arthritis<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">,</span> <span class="punctuation">,</span> Sex <span class="operator">=</span> Female</span><br><span class="line"></span><br><span class="line">         Improved</span><br><span class="line">Treatment None Some Marked</span><br><span class="line">  Placebo   <span class="number">19</span>    <span class="number">7</span>      <span class="number">6</span></span><br><span class="line">  Treated    <span class="number">6</span>    <span class="number">5</span>     <span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">,</span> <span class="punctuation">,</span> Sex <span class="operator">=</span> Male</span><br><span class="line"></span><br><span class="line">         Improved</span><br><span class="line">Treatment None Some Marked</span><br><span class="line">  Placebo   <span class="number">10</span>    <span class="number">0</span>      <span class="number">1</span></span><br><span class="line">  Treated    <span class="number">7</span>    <span class="number">2</span>      <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>结果看起来有点乱，这时候我们可以使用ftable()函数，它能将结果转换为一个平铺式的列联表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">y &lt;- xtabs(~ Treatment+Improved+Sex,data = Arthritis)</span><br><span class="line"></span><br><span class="line">&gt; ftable(y)</span><br><span class="line">                   Sex Female Male</span><br><span class="line">Treatment Improved                </span><br><span class="line">Placebo   None             19   10</span><br><span class="line">          Some              7    0</span><br><span class="line">          Marked            6    1</span><br><span class="line">Treated   None              6    7</span><br><span class="line">          Some              5    2</span><br><span class="line">          Marked           16    5</span><br></pre></td></tr></table></figure>

<h4 id="独立性检验函数"><a href="#独立性检验函数" class="headerlink" title="独立性检验函数"></a>独立性检验函数</h4><p>独立性检验是根据频数信息判断两类因子彼此相关或相互独立的假设性检验，所谓独立性就是指变量之间是独立的，没有关系。</p>
<p>根据分组计算的频数表就可以进行独立性检验。</p>
<p>主要介绍三种检验方法：卡方检验、Fisher检验、cochan-mantel-haenszel检验<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221114195256.png"></p>
<p>p-value就是probability的值，它是一个通过计算得到的概率值，也就是在原假设为真实，得到最大的或者抄书做得到的检验统计量值的概率。一般将p值定位到0.05，当p&lt;0.05时，拒绝原假设（也就是假设成立），p&gt;0.05是不拒绝原假设。</p>
<p>还是使用arthritis数据集，探究药物治疗有没有成效，检验“treatment”和“improved”是不是相互独立的，如果相互独立，说明二者没有关系，药物治疗没有作用，反之则是有效果。</p>
<p>先使用table()函数计算两者的频数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mytable <span class="operator">&lt;-</span> table<span class="punctuation">(</span>Arthritis<span class="operator">$</span>Treatment<span class="punctuation">,</span>Arthritis<span class="operator">$</span>Improved<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>接下来就可以直接使用chisq.test()函数进行卡方独立检验，直接将结果输入这个函数就行：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chisq.test<span class="punctuation">(</span>mytable<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 结果如下，p值约等于0.0014小于0.05，说明两者不是独立的，两者有关系，治疗是有效果的：</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116175425.png"></p>
<p>这种待检测的变量之间没有顺序的关系，调整两者的顺序，结果是一样的：(这句是废话)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mytable <span class="operator">&lt;-</span> table<span class="punctuation">(</span>Arthritis<span class="operator">$</span>Improved<span class="punctuation">,</span>Arthritis<span class="operator">$</span>Treatment<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">chisq.test<span class="punctuation">(</span>mytable<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>Fisher精确检验：</p>
<p>Fisher精确检验使用的函数是Fisher.test()，同样是进行独立性检验，但是与卡方检验不同的是，Fisher精确检验的原假设是：边界固定的列联表中行和列相互独立的。</p>
<p>还是同样的例子，采用Fisher精确检验：<br>结果为p值约等于0.0013，Fisher检验适合小样本的检验，精度低于卡方检验</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mytable <span class="operator">&lt;-</span> xtabs<span class="punctuation">(</span><span class="operator">~</span>Treatment<span class="operator">+</span>Improved<span class="punctuation">,</span>data <span class="operator">=</span> Arthritis<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> fisher.test<span class="punctuation">(</span>mytable<span class="punctuation">)</span></span><br><span class="line">	Fisher<span class="string">&#x27;s Exact Test for Count Data</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">data:  mytable</span></span><br><span class="line"><span class="string">p-value = 0.001393</span></span><br><span class="line"><span class="string">alternative hypothesis: two.sided</span></span><br></pre></td></tr></table></figure>

<p>cochan-mantel-haenszel检验：</p>
<ul>
<li>cochan-mantel-haenszel检验使用的函数是mantelhaen.test()，该鲜艳的原假设是两个名义变量在第三个变量的每一层中都是条件独立的。这个检验需要三个变量，此处我们来检测一下</li>
<li>“treatment”、“sex”以及“improved”之间的关系：<ul>
<li>首先计算三个变量的列联表，使用xtabs()计算：<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mytable <span class="operator">&lt;-</span> xtabs<span class="punctuation">(</span><span class="operator">~</span>Treatment<span class="operator">+</span>Improved<span class="operator">+</span>Sex<span class="punctuation">,</span>data <span class="operator">=</span> Arthritis<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> mantelhaen.test<span class="punctuation">(</span>mytable<span class="punctuation">)</span></span><br><span class="line">	Cochran<span class="operator">-</span>Mantel<span class="operator">-</span>Haenszel test</span><br><span class="line"></span><br><span class="line">data<span class="operator">:</span>  mytable</span><br><span class="line">Cochran<span class="operator">-</span>Mantel<span class="operator">-</span>Haenszel M<span class="operator">^</span><span class="number">2</span> <span class="operator">=</span> <span class="number">14.632</span><span class="punctuation">,</span> df <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> p<span class="operator">-</span>value</span><br><span class="line"><span class="operator">=</span> <span class="number">0.0006647</span></span><br><span class="line"><span class="comment"># 结果为p值约等于0.0006，小于0.05，也就说明，药物治疗和改善情况在性别的每一个水平上不独立（因为这里使用了性别做第三层分类量）：</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>结果为p值约等于0.0006，小于0.05，也就说明，药物治疗和改善情况在性别的每一个水平上不独立（因为这里使用了性别做第三层分类量）：</p>
<p>如果调整变量顺序，反映的结果是有差别的：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mytable <span class="operator">&lt;-</span> xtabs<span class="punctuation">(</span><span class="operator">~</span>Treatment<span class="operator">+</span>Sex<span class="operator">+</span>Improved<span class="punctuation">,</span>data <span class="operator">=</span> Arthritis<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> mantelhaen.test<span class="punctuation">(</span>mytable<span class="punctuation">)</span></span><br><span class="line">	Mantel<span class="operator">-</span>Haenszel chi<span class="operator">-</span>squared test with continuity</span><br><span class="line">	correction</span><br><span class="line"></span><br><span class="line">data<span class="operator">:</span>  mytable</span><br><span class="line">Mantel<span class="operator">-</span>Haenszel X<span class="operator">-</span>squared <span class="operator">=</span> <span class="number">2.0863</span><span class="punctuation">,</span> df <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> p<span class="operator">-</span>value <span class="operator">=</span></span><br><span class="line"><span class="number">0.1486</span></span><br><span class="line">alternative hypothesis<span class="operator">:</span> true common odds ratio is not equal to <span class="number">1</span></span><br><span class="line"><span class="number">95</span> percent confidence interval<span class="operator">:</span></span><br><span class="line"> <span class="number">0.8566711</span> <span class="number">8.0070521</span></span><br><span class="line">sample estimates<span class="operator">:</span></span><br><span class="line">common odds ratio </span><br><span class="line">         <span class="number">2.619048</span></span><br><span class="line"><span class="comment"># 结果为p值约等于0.14，大于0.05，也就说明，药物治疗和性别在改善情况的每一个水平上独立（因为这里使用了改善情况做第三层分类量）</span></span><br></pre></td></tr></table></figure>

<h4 id="相关性分析函数"><a href="#相关性分析函数" class="headerlink" title="相关性分析函数"></a>相关性分析函数</h4><p>相关性分析是指对两个或者多个具备相关性的变量元素进行分析，从而衡量两个变量因素的相关密切程度。相关性元素之间需要存在一定的联系或者概率才可以进行相关性分析，简单来说就是变量之间是否有关系（也就是说需要先进行独立检测之后才能进行相关分析）。</p>
<p>相关系数的大小表示相关性的大小，相关系数包括：pearson相关系数、spearman相关系数、kendall相关系数、偏相关系数、多分格相关系数和多系列相关系数</p>
<p>与独立性检验不同，相关性分析中每种方法都没有独立的函数，这里面计算相关性系数都使用同一个函数：cor()函数。</p>
<p>cor()函数可以计算三种相关性系数，包括pearson相关系数、spearman相关系数和kendall相关系数，具体使用哪种方法可以使用选项参数中的参数method来指定（默认是用pearson相关系数），；函数中还有一个use选项，用于指定如何对待缺失值，是不处理还是删除等。</p>
<p>此处我们使用state.x77数据作为实例数据（这是一个矩阵数据）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cor<span class="punctuation">(</span>state.x77<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116180218.png"></p>
<p>一般相关数据都是在[0,1]之间，数值越大越相关，正负号表示是正相关还是负相关</p>
<p>除了cor()函数之外，还有一个cov()函数可以用来计算协方差，携房产可以用来衡量两个变量的整体误差</p>
<p>例如我们定义两个变量：x,y</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x <span class="operator">&lt;-</span> state.x77<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">y <span class="operator">&lt;-</span> state.x77<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>再使用cor()函数计算两者之间的相关系数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> cor<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span></span><br><span class="line">              Life Exp     Murder</span><br><span class="line">Population <span class="operator">-</span><span class="number">0.06805195</span>  <span class="number">0.3436428</span></span><br><span class="line">Income      <span class="number">0.34025534</span> <span class="operator">-</span><span class="number">0.2300776</span></span><br><span class="line">Illiteracy <span class="operator">-</span><span class="number">0.58847793</span>  <span class="number">0.7029752</span></span><br><span class="line">HS Grad     <span class="number">0.58221620</span> <span class="operator">-</span><span class="number">0.4879710</span></span><br></pre></td></tr></table></figure>
<p>结果看起来会比较整洁、清爽</p>
<p>cor()函数只能计算三种相关系数，其他相关系数的计算可以通过R的拓展包来实现：</p>
<ul>
<li>可以使用“ggm”这个包中的pcor()函数计算偏相关系数。</li>
<li>偏相关系数是指在控制一个或者多个变量时，剩余其他变量之间的相互关系：<ul>
<li>pcor()函数需要输入两个重要的参数，第一个参数是一个数值向量（前两个数值表示要计算相关系数的下标，其余的数值为条件变量的下标），第二个参数是cov()函数计算出来的协方差结果</li>
<li>比如此处我们想控制收入水平、文盲率和高中毕业率的影响，看人口（第一列）和谋杀率（第五列）之间的关系（先获取列名，不然容易混）：<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">colnames<span class="punctuation">(</span>state.x77<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pcor<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span>cov<span class="punctuation">(</span>state.x77<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>偏相关系数的结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">0.3462724</span></span><br></pre></td></tr></table></figure>

<h4 id="相关性检验函数"><a href="#相关性检验函数" class="headerlink" title="相关性检验函数"></a>相关性检验函数</h4><p>在进行相关性分析之后，对相关性进行检验，cor.test()函数可用于相关性的检验，该函数有四个比较重要的选项参数，其中x和y是需要检测的相关性变量，alternative是用来指定进行双侧检验还是单侧检验，two.sided代表分别检测正负相关性，greater代表正相关，less代表负相关。Method选项用于指定用哪种相关系数，可选的有pearson相关系数、spearman相关系数、kendall相关系数。</p>
<p>我们使用state.x77数据检测一下谋杀率与文盲率之间的关系</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> cor.test<span class="punctuation">(</span>state.x77<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span>state.x77<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">	Pearson<span class="string">&#x27;s product-moment correlation</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">data:  state.x77[, 3] and state.x77[, 5]</span></span><br><span class="line"><span class="string">t = 6.8479, df = 48, p-value = 1.258e-08</span></span><br><span class="line"><span class="string">alternative hypothesis: true correlation is not equal to 0</span></span><br><span class="line"><span class="string">95 percent confidence interval:</span></span><br><span class="line"><span class="string"> 0.5279280 0.8207295</span></span><br><span class="line"><span class="string">sample estimates:</span></span><br><span class="line"><span class="string">      cor </span></span><br><span class="line"><span class="string">0.7029752</span></span><br></pre></td></tr></table></figure>

<p>置信区间：confidential interval，是指样本统计量所构造的总体参数的估计区间，在统计学中，一个概率样本的置信区间是对这个样本的某个总体参数的区间估计，置信区间展现的是这个参数的真实值有一定的概率落在测量结果周围的程度，置信区间给出的是被测量参数的测量值的可信程度（也就是说，光给出概率还不行，还要给出概率发生的范围）</p>
<p>Cor.test()只能一次性检测一组变量的关系，psych包中的corr.test()函数可以一次性进行多个变量的检验，这个函数还可以进行递归操作</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> corr.test<span class="punctuation">(</span>state.x77<span class="punctuation">)</span></span><br><span class="line">Call<span class="operator">:</span>corr.test<span class="punctuation">(</span>x <span class="operator">=</span> state.x77<span class="punctuation">)</span></span><br><span class="line">Correlation matrix </span><br><span class="line">           Population Income Illiteracy Life Exp Murder</span><br><span class="line">Population       <span class="number">1.00</span>   <span class="number">0.21</span>       <span class="number">0.11</span>    <span class="operator">-</span><span class="number">0.07</span>   <span class="number">0.34</span></span><br><span class="line">Income           <span class="number">0.21</span>   <span class="number">1.00</span>      <span class="operator">-</span><span class="number">0.44</span>     <span class="number">0.34</span>  <span class="operator">-</span><span class="number">0.23</span></span><br><span class="line">Illiteracy       <span class="number">0.11</span>  <span class="operator">-</span><span class="number">0.44</span>       <span class="number">1.00</span>    <span class="operator">-</span><span class="number">0.59</span>   <span class="number">0.70</span></span><br><span class="line">Life Exp        <span class="operator">-</span><span class="number">0.07</span>   <span class="number">0.34</span>      <span class="operator">-</span><span class="number">0.59</span>     <span class="number">1.00</span>  <span class="operator">-</span><span class="number">0.78</span></span><br><span class="line">Murder           <span class="number">0.34</span>  <span class="operator">-</span><span class="number">0.23</span>       <span class="number">0.70</span>    <span class="operator">-</span><span class="number">0.78</span>   <span class="number">1.00</span></span><br><span class="line">HS Grad         <span class="operator">-</span><span class="number">0.10</span>   <span class="number">0.62</span>      <span class="operator">-</span><span class="number">0.66</span>     <span class="number">0.58</span>  <span class="operator">-</span><span class="number">0.49</span></span><br><span class="line">Frost           <span class="operator">-</span><span class="number">0.33</span>   <span class="number">0.23</span>      <span class="operator">-</span><span class="number">0.67</span>     <span class="number">0.26</span>  <span class="operator">-</span><span class="number">0.54</span></span><br><span class="line">Area             <span class="number">0.02</span>   <span class="number">0.36</span>       <span class="number">0.08</span>    <span class="operator">-</span><span class="number">0.11</span>   <span class="number">0.23</span></span><br><span class="line">           HS Grad Frost  Area</span><br><span class="line">Population   <span class="operator">-</span><span class="number">0.10</span> <span class="operator">-</span><span class="number">0.33</span>  <span class="number">0.02</span></span><br><span class="line">Income        <span class="number">0.62</span>  <span class="number">0.23</span>  <span class="number">0.36</span></span><br><span class="line">Illiteracy   <span class="operator">-</span><span class="number">0.66</span> <span class="operator">-</span><span class="number">0.67</span>  <span class="number">0.08</span></span><br><span class="line">Life Exp      <span class="number">0.58</span>  <span class="number">0.26</span> <span class="operator">-</span><span class="number">0.11</span></span><br><span class="line">Murder       <span class="operator">-</span><span class="number">0.49</span> <span class="operator">-</span><span class="number">0.54</span>  <span class="number">0.23</span></span><br><span class="line">HS Grad       <span class="number">1.00</span>  <span class="number">0.37</span>  <span class="number">0.33</span></span><br><span class="line">Frost         <span class="number">0.37</span>  <span class="number">1.00</span>  <span class="number">0.06</span></span><br><span class="line">Area          <span class="number">0.33</span>  <span class="number">0.06</span>  <span class="number">1.00</span></span><br><span class="line">Sample Size </span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">50</span></span><br><span class="line">Probability values <span class="punctuation">(</span>Entries above the diagonal are adjusted <span class="keyword">for</span> multiple tests.<span class="punctuation">)</span> </span><br><span class="line">           Population Income Illiteracy Life Exp Murder</span><br><span class="line">Population       <span class="number">0.00</span>   <span class="number">1.00</span>       <span class="number">1.00</span>     <span class="number">1.00</span>   <span class="number">0.23</span></span><br><span class="line">Income           <span class="number">0.15</span>   <span class="number">0.00</span>       <span class="number">0.03</span>     <span class="number">0.23</span>   <span class="number">1.00</span></span><br><span class="line">Illiteracy       <span class="number">0.46</span>   <span class="number">0.00</span>       <span class="number">0.00</span>     <span class="number">0.00</span>   <span class="number">0.00</span></span><br><span class="line">Life Exp         <span class="number">0.64</span>   <span class="number">0.02</span>       <span class="number">0.00</span>     <span class="number">0.00</span>   <span class="number">0.00</span></span><br><span class="line">Murder           <span class="number">0.01</span>   <span class="number">0.11</span>       <span class="number">0.00</span>     <span class="number">0.00</span>   <span class="number">0.00</span></span><br><span class="line">HS Grad          <span class="number">0.50</span>   <span class="number">0.00</span>       <span class="number">0.00</span>     <span class="number">0.00</span>   <span class="number">0.00</span></span><br><span class="line">Frost            <span class="number">0.02</span>   <span class="number">0.11</span>       <span class="number">0.00</span>     <span class="number">0.07</span>   <span class="number">0.00</span></span><br><span class="line">Area             <span class="number">0.88</span>   <span class="number">0.01</span>       <span class="number">0.59</span>     <span class="number">0.46</span>   <span class="number">0.11</span></span><br><span class="line">           HS Grad Frost Area</span><br><span class="line">Population    <span class="number">1.00</span>  <span class="number">0.25</span> <span class="number">1.00</span></span><br><span class="line">Income        <span class="number">0.00</span>  <span class="number">1.00</span> <span class="number">0.16</span></span><br><span class="line">Illiteracy    <span class="number">0.00</span>  <span class="number">0.00</span> <span class="number">1.00</span></span><br><span class="line">Life Exp      <span class="number">0.00</span>  <span class="number">0.79</span> <span class="number">1.00</span></span><br><span class="line">Murder        <span class="number">0.01</span>  <span class="number">0.00</span> <span class="number">1.00</span></span><br><span class="line">HS Grad       <span class="number">0.00</span>  <span class="number">0.16</span> <span class="number">0.25</span></span><br><span class="line">Frost         <span class="number">0.01</span>  <span class="number">0.00</span> <span class="number">1.00</span></span><br><span class="line">Area          <span class="number">0.02</span>  <span class="number">0.68</span> <span class="number">0.00</span></span><br><span class="line"></span><br><span class="line"> To see confidence intervals of the correlations<span class="punctuation">,</span> print with the short<span class="operator">=</span><span class="literal">FALSE</span> option</span><br></pre></td></tr></table></figure>

<p>如果想进行偏相关系数的检验，可以使用ggm包中的pcor.test()函数，先计算偏相关系数</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> ggm<span class="operator">::</span>pcor<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span>cov<span class="punctuation">(</span>state.x77<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">0.3462724</span></span><br></pre></td></tr></table></figure>
<p>其中，x是pcor()函数计算的偏相关系数，然后是要控制的变量数，最后就是样本数</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x <span class="operator">&lt;-</span> ggm<span class="operator">::</span>pcor<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span>cov<span class="punctuation">(</span>state.x77<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>返回三个值，分别是t检验，自由度和p value</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; ggm::pcor.test(x,3,50)</span><br><span class="line">$tval</span><br><span class="line">[1] 2.476049</span><br><span class="line"></span><br><span class="line">$df</span><br><span class="line">[1] 45</span><br><span class="line"></span><br><span class="line">$pvalue</span><br><span class="line">[1] 0.01711252</span><br></pre></td></tr></table></figure>

<p>分组数据的相关性检验，这种分组的检验可以使用t检验，t检验使用t分布理论，推论差异分布的概率，从而比较两个平均数的差异是否显著。主要用于样本含量较小，一般小于30个，总体标准差未知的正态分布数据</p>
<ul>
<li>这里我们使用MASS包中的UScrime数据集，它包含了1960年美国47各州的刑罚制度对犯罪率的影响。</li>
<li>首先使用t.test()进行独立样本的t检验，t.test(y~x)，y是一个数值型变量，x是类别型变量，<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> t.test<span class="punctuation">(</span>Prob <span class="operator">~</span> So<span class="punctuation">,</span>data <span class="operator">=</span> UScrime<span class="punctuation">)</span></span><br><span class="line">	Welch Two Sample t<span class="operator">-</span>test</span><br><span class="line"></span><br><span class="line">data<span class="operator">:</span>  Prob by So</span><br><span class="line">t <span class="operator">=</span> <span class="operator">-</span><span class="number">3.8954</span><span class="punctuation">,</span> df <span class="operator">=</span> <span class="number">24.925</span><span class="punctuation">,</span> p<span class="operator">-</span>value <span class="operator">=</span> <span class="number">0.0006506</span></span><br><span class="line">alternative hypothesis<span class="operator">:</span> true difference <span class="keyword">in</span> means between group <span class="number">0</span> and group <span class="number">1</span> is not equal to <span class="number">0</span></span><br><span class="line"><span class="number">95</span> percent confidence interval<span class="operator">:</span></span><br><span class="line"> <span class="operator">-</span><span class="number">0.03852569</span> <span class="operator">-</span><span class="number">0.01187439</span></span><br><span class="line">sample estimates<span class="operator">:</span></span><br><span class="line">mean <span class="keyword">in</span> group <span class="number">0</span> mean <span class="keyword">in</span> group <span class="number">1</span> </span><br><span class="line">     <span class="number">0.03851265</span>      <span class="number">0.06371269</span></span><br></pre></td></tr></table></figure>
P&lt;0.05，因此可以拒绝南方各州北方各州拥有相同犯罪率的假设。</li>
</ul>
<p>如果不满足正态分布，就需要用非参数的方法，非参数检验在总体方差未知或者知道甚少的情况下，利用样本数据对总体分布形态等进行推断的方法，由于非参数检验方法在推断过程中不涉及有关总体分布的参数，因而得名为 <strong>“非参数检验”</strong></p>
<p><strong>参数检验</strong>是在总体分布形式已知的情况下，对总体分布的参数如均值、方差等进行推断的方法，也就是数据分布已知，比如满足正态分布</p>
<h4 id="绘图函数"><a href="#绘图函数" class="headerlink" title="绘图函数"></a>绘图函数</h4><p>R语言四大作图系统</p>
<ul>
<li>基础绘图系统、lattice包、ggplot2包、grid包</li>
<li>可以使用demo(graphics)命令显示出R内置绘图函数可以做的一些图</li>
</ul>
<p>R基础绘图系统包括两种绘图，高级绘图是一步到位可以直接绘制出图，而第几回吐，不能单独使用，必须在高级绘图产生图形的基础上，对图形进行调整，比如加一条线，加上标题文字等。</p>
<p>对于绘图函数要注意的是输入数据的格式</p>
<p>Plot()函数</p>
<ul>
<li>Plot()函数可以接受一个单独的数值向量，例如：<ul>
<li><code>plot(women$heigh)</code>绘制的是散点图</li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116181738.png" alt="200"></li>
</ul>
</li>
<li>如果输入的数据是因子，绘制出来的则是直方图<ul>
<li><code>plot(as.factor(women$height))</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116181828.png" alt="300"></li>
</ul>
</li>
<li>如果输入数据是一个因子数据和一个数值数据，则是箱线图<ul>
<li><code>plot(as.factor(mtcars$cyl),mtcars$carb)</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116181947.png" alt="300"></li>
</ul>
</li>
<li>如果输入第一个是数值数据，第二个是因子，输出的是散列图：<ul>
<li><code>plot(mtcars$carb,as.factor(mtcars$cyl))</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116182047.png" alt="300"></li>
</ul>
</li>
<li>如果两个输入数据都是因子，输出的就是棘状图：<ul>
<li><code>&gt; plot(as.factor(mtcars$cyl),as.factor(mtcars$carb))</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116182154.png" alt="300"></li>
</ul>
</li>
<li>Plot()函数还可以接受函数公式：<code>plot(women$height~women$weight)</code>输出的是二者的关系图<ul>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116182144.png" alt="300"></li>
</ul>
</li>
<li>还可以用plot()函数直接绘制线性回归的结果：<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fit <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>height<span class="operator">~</span>weight<span class="punctuation">,</span>data<span class="operator">=</span>women<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
fit的值是线性回归的结果：<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116182255.png" alt="300"></li>
</ul>
<p>Par()函数：</p>
<ul>
<li>Par()并不能直接接用来绘图，而是对绘图参数进行调整</li>
<li>par()<ul>
<li>直接敲par()，会跳出关于绘图的所有参数设置<ul>
<li>例如我们绘制mtcars数据的因子数据图时，加上颜色<code>plot(as.factor(mtcars$cyl),col=c(&quot;red&quot;,&quot;green&quot;,&quot;blue&quot;))</code></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116182431.png" alt="300"></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h4><p>编写函数就是为了减少重复代码的书写，从而让脚本更加简洁高效，增加可读性</p>
<ul>
<li>在R中，如果直接写函数不加括号，就会显示函数的源代码</li>
<li>一个完整的R函数需要包括函数名称、函数声明、函数参数、函数体</li>
<li>函数名称：函数的命名最好和函数的功能相关，可以使字母和数字的组合，但必须是字母开头</li>
<li>函数声明：利用function函数来声明，用来告诉R这个东西是函数<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116182453.png"></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># calculate skewness and peakness;kurtosis</span><br><span class="line"># 偏度（skewness），是统计数据分布偏斜方向和程度的度量，是统计数据分布非对称程度的数字特征</span><br><span class="line"># 峰度（peakness; kurtosis），又称峰态系数，表征概率密度分布曲线在平均值处峰值高低的特征数</span><br><span class="line">mystats &lt;- function(x,na.omit=FALSE)&#123;</span><br><span class="line">	if(na.omit)</span><br><span class="line">		x &lt;- x[!is.na(x)]</span><br><span class="line">	m &lt;- mean(x)</span><br><span class="line">	n &lt;- length(x)</span><br><span class="line">	s &lt;- sd(x)</span><br><span class="line">	skew &lt;- sum((x-m^3/s^3))/n</span><br><span class="line">	kurt &lt;- sum((x-m^4/s^4))/n-3</span><br><span class="line">	return (c(n=m,mean=m,stdev=s,skew=skew,kurtosis=kurt))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="项目实操-数据分析实战"><a href="#项目实操-数据分析实战" class="headerlink" title="项目实操-数据分析实战"></a>项目实操-数据分析实战</h2><h3 id="001-线性回归"><a href="#001-线性回归" class="headerlink" title="001 线性回归"></a>001 线性回归</h3><p>回归，通常指用一个或多个预测变量，也成自变量或者解释变量，来预测响应变量，也称因变量、标效变量或者结果变量的方法</p>
<ul>
<li>回归分析主要用于分析自变量对因变量的影响</li>
<li>重点是：如何建立模型、抽象出数学公式、哪些因素与模型有关、需要利用多少样品、模型的准确率有多高、在实际运用中还是否有效？</li>
<li>R表达式中常用的符号 <img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116183226.png"></li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116183052.png"></li>
<li>最简单的线性回归：普通最小二乘回归法（OLS）</li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116183131.png"></li>
<li>我们可以使用lm()函数来进行线性回归分析，lm: linear medel 线性回归模型<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lm<span class="punctuation">(</span>formula<span class="punctuation">,</span> data<span class="punctuation">,</span> subset<span class="punctuation">,</span> weights<span class="punctuation">,</span> na.action<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&quot;qr&quot;</span><span class="punctuation">,</span> model <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> qr <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> singular.ok <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> contrasts <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> offset<span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># formula：是要进行拟合的模型形式，写成一个公式，例如，y ~ ax+b</span></span><br><span class="line"><span class="comment"># data：是要使用的数据集，是数据框的格式%%</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>一般在回归分析中，都喜欢用fit这个变量名来定义结果，寻找回归模型的过程被称为拟合</p>
<p>如果后面data参数中指定了数据集，那么前面公式中的变量就可以直接写变量名字（注意，因变量在波浪线左边，自变量在右边）</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>weight <span class="operator">~</span> height<span class="punctuation">,</span>data <span class="operator">=</span> women<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>回归结果，可以使用summary()函数查看详细的分析结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> summary<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br><span class="line">Call<span class="operator">:</span></span><br><span class="line">lm<span class="punctuation">(</span>formula <span class="operator">=</span> weight <span class="operator">~</span> height<span class="punctuation">,</span> data <span class="operator">=</span> women<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">Residuals<span class="operator">:</span></span><br><span class="line">    Min      <span class="number">1</span>Q  Median      <span class="number">3</span>Q     Max </span><br><span class="line"><span class="operator">-</span><span class="number">1.7333</span> <span class="operator">-</span><span class="number">1.1333</span> <span class="operator">-</span><span class="number">0.3833</span>  <span class="number">0.7417</span>  <span class="number">3.1167</span> </span><br><span class="line"></span><br><span class="line">Coefficients<span class="operator">:</span></span><br><span class="line">             Estimate Std. Error t value Pr<span class="punctuation">(</span><span class="operator">&gt;</span><span class="operator">|</span>t<span class="operator">|</span><span class="punctuation">)</span>    </span><br><span class="line"><span class="punctuation">(</span>Intercept<span class="punctuation">)</span> <span class="operator">-</span><span class="number">87.51667</span>    <span class="number">5.93694</span>  <span class="operator">-</span><span class="number">14.74</span> <span class="number">1.71e-09</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">height        <span class="number">3.45000</span>    <span class="number">0.09114</span>   <span class="number">37.85</span> <span class="number">1.09e-14</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line"><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span></span><br><span class="line">Signif. codes<span class="operator">:</span>  </span><br><span class="line"><span class="number">0</span> ‘<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.001</span> ‘<span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.01</span> ‘<span class="operator">*</span>’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></span><br><span class="line"></span><br><span class="line">Residual standard error<span class="operator">:</span> <span class="number">1.525</span> on <span class="number">13</span> degrees of freedom</span><br><span class="line">Multiple R<span class="operator">-</span>squared<span class="operator">:</span>  <span class="number">0.991</span><span class="punctuation">,</span>	Adjusted R<span class="operator">-</span>squared<span class="operator">:</span>  <span class="number">0.9903</span> </span><br><span class="line"><span class="built_in">F</span><span class="operator">-</span>statistic<span class="operator">:</span>  <span class="number">1433</span> on <span class="number">1</span> and <span class="number">13</span> DF<span class="punctuation">,</span>  p<span class="operator">-</span>value<span class="operator">:</span> <span class="number">1.091e-14</span></span><br></pre></td></tr></table></figure>
<ul>
<li>首先是call这一列，是列出使用的回归的公式。</li>
<li>然后是residuals，表示残差，残差是真实值和预测值之间的差，例如数据第一行，真实的值是58，将58代入预测公式，得出的预测值y，y与58之间的差值就是残差，残差给出了四个值，最小值、最大值、中位值、四分之一的值、四分之三的值，这四个值越小，说明预测模型越精确</li>
<li>Coefficients：系数项，intercept：截距项（当x等于0时，与y轴的相交点）</li>
<li>Estimate是项系数的值，pr就是pvalue，是假设x与y不相关时候的概率，这个值也是小于0.05比较好，residual standard error残差标准误，表示残差的标准误差，这个也是越小越好。</li>
<li>Multiple R-squared:  0.991,	Adjusted R-squared:  0.9903 F-statistic:  1433 on 1 and 13 DF,  p-value: 1.091e-14<ul>
<li>这两个值称为R方判定系数，是衡量模型拟合质量的指标，它是表示回归模型所能解释的响应变量的方差比例，比如此处，就代表这个模型可以解释99.1%的数据，只有0.9%的数据不符合这个模型，取值在0-1之间，值越大于好。</li>
</ul>
</li>
<li>最后是F-statistic（F统计量），这个值说明模型是否显著，也是用pvalue来衡量，也是值越小越好。<br>得出回归模型是：<code>Weight=3.45*height-87.52</code>是一个一元一次方程</li>
</ul>
<p>在线性回归的结果中，一般先看F统计量，如果F统计量不显著（pvalue不小于0.05），那么这个模型就没有价值了，需要重新进行拟合，如果小于0.05，再看R方差，模型能解释多少变量。</p>
<h4 id="线性拟合常用的函数"><a href="#线性拟合常用的函数" class="headerlink" title="线性拟合常用的函数"></a>线性拟合常用的函数</h4><p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116183712.png"><br>使用predict()函数可以用拟合模型对新的数据集进行预测</p>
<p>直接使用plot()函数可以对拟合结果进行绘图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>会生成四幅图：残差拟合图、正态分布qq图、大小位置图以及残差影响图</p>
<p>Abline()函数可以绘制出拟合曲线，但这个命令属于低级绘图命令，必须在高级绘图的基础上完成，我们先绘制身高与体重的散点图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plot<span class="punctuation">(</span>women<span class="operator">$</span>height<span class="punctuation">,</span>women<span class="operator">$</span>weight<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> abline<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116183918.png" alt="300"></p>
<p>最小二乘法的原理就是找到一条直线（拟合直线），使残差平方和最小</p>
<ul>
<li>一般拟合曲线很少是直线，大部分都是曲线，也就是多项式的回归</li>
<li>还是women这个数据集，我们用多项式回归试一下：<ul>
<li>先定义一个fit2变量</li>
<li>将体重作为因变量，身高与身高的平方作为自变量</li>
<li><code> fit2 &lt;- lm(weight ~ height+I(height^2),data = women)</code></li>
<li>可以对比两次回归的曲线差异</li>
<li><code>plot(women$height,women$weight)</code></li>
<li><code>abline(fit)</code></li>
<li>这次使用lines()函数，这个函数能把点连成线，横坐标是身高数据，纵坐标是根据拟合模型的得出的预测值，为了增加比较的差异性，我们给第二个曲线增加颜色<ul>
<li><code>lines(women$height,fitted(fit2),col=&quot;red&quot;)</code></li>
<li>对比很明显，带有二次项的回归模型能够更好的拟合数据，使得更多的点落在曲线上</li>
<li><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116184210.png"></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>那么，三次项的回归模型效果是不是更好呢？我们再来拟合一下</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fit3 <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>weight <span class="operator">~</span> height<span class="operator">+</span>I<span class="punctuation">(</span>height<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span><span class="operator">+</span>I<span class="punctuation">(</span>height<span class="operator">^</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span>data<span class="operator">=</span>women<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>women<span class="operator">$</span>height<span class="punctuation">,</span>women<span class="operator">$</span>weight<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">abline<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">lines<span class="punctuation">(</span>women<span class="operator">$</span>height<span class="punctuation">,</span>fitted<span class="punctuation">(</span>fit2<span class="punctuation">)</span><span class="punctuation">,</span>col<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">lines<span class="punctuation">(</span>women<span class="operator">$</span>height<span class="punctuation">,</span>fitted<span class="punctuation">(</span>fit3<span class="punctuation">)</span><span class="punctuation">,</span>col<span class="operator">=</span><span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>拟合结果如图：<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116184233.png"><br>结果表明，继续增加多项式可以提高拟合度，但是其实没有必要，因为用于拟合的数据集，只是用于建模的数据集，不一定适合真实的数据，过多的拟合也是纸上谈兵。</p>
<h3 id="002-多元线性回归"><a href="#002-多元线性回归" class="headerlink" title="002 多元线性回归"></a>002 多元线性回归</h3><p>当预测变量不止一个时，简单现象回归就变成了多元线性回归，相当于求解多元方程，而且和方程式求解不同的是，这些变量的权重还不一样，有些大 ，有些小，有些或者是没有多大影响，下面我们来看一个案例：</p>
<p>以state.x77这个数据集为例，求解出一个拟合模型，然后可以根据某些指标预测出犯罪率：</p>
<ul>
<li>首先我们将state.x77这个矩阵数据转化成数据框，因为lm()函数输入数据必须是数据框的格式</li>
<li>这里为了简化问题，我们只取四个指标进行回归分析：population、illiteracy、income、frost<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">states <span class="operator">&lt;-</span> as.data.frame<span class="punctuation">(</span>state.x77<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Murder&quot;</span><span class="punctuation">,</span><span class="string">&#x27;Population&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;Illiteracy&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;Income&#x27;</span><span class="punctuation">,</span><span class="string">&quot;Frost&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>还是使用一个lm()函数，定义一个fit变量，用于存储模型结果</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>Murder <span class="operator">~</span> Population<span class="operator">+</span>Illiteracy<span class="operator">+</span>Income<span class="operator">+</span>Frost<span class="punctuation">,</span>data <span class="operator">=</span> states<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<p>使用summary()函数查看模型的详细过程结果</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> summary<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>我们可以使用coef()函数单独查看各项的系数，根据系数项和截距值就能写出拟合方程</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">coef<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">options<span class="punctuation">(</span>digits <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>可以通过options()的digits参数设置显示的位数</p>
<p>下面我们来列举一个更复杂的例子，在很多研究中，变量会有交互项，也就是变量相互之间并不是独立的，例如mtcars数据集，汽车的重量与马力之间存在着交互，质量大会影响到马力。交互项就是解释变量之间存在相关性</p>
<p>我们来拟合一下mtcars数据集中，每加仑汽油行驶里程数（mpg）变量与马力（hp）以及车重（wt）之间的关系</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fit <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>mpg <span class="operator">~</span> hp<span class="operator">+</span>wt<span class="operator">+</span>hp<span class="operator">:</span>wt<span class="punctuation">,</span>data <span class="operator">=</span> mtcars<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">summary<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>从结果中可以看见，车重与马力的交互项是非常显著的，这就说明响应变量mpg与其中一个预测变量的关系依赖于另一个预测变量的水平，其实就是说，每加仑汽油行驶里程数域与汽车马力的关系需要依赖汽车的不同而不同。</p>
<p>对于多元线性回归存在的一个问题就是，如果存在多个变量，就需要考虑变量之间的相互影响和回归时的组合关系，也就是如何从众多可能的模型中选择最佳的模型呢？</p>
<p>比如是不是需要包括所有的变量，还是需要去掉一些对模型贡献不显著的变量，是否需要添加多项式或者是交互项来提高拟合度呢？</p>
<p>那么对于以上的问题，我们可以使用AIC()函数来比较模型。</p>
<p>AIC()函数是An Information Criterion的简称，称为赤池信息准则，这个准则考虑了模型统计拟合度以及用来拟合的参数数目</p>
<p>计算得到的AIC值越小越好，越小说明模型用较少的参数就可以获得足够的拟合度</p>
<p>例如上面拟合犯罪度的案例</p>
<p>Ctrl+UP调出历史代码列表</p>
<p>对比一下两个fit的拟合度</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fit1 <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>Murder <span class="operator">~</span> Population<span class="operator">+</span>Illiteracy<span class="operator">+</span>Income<span class="operator">+</span>Frost<span class="punctuation">,</span>data <span class="operator">=</span> states<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">fit2 <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>Murder <span class="operator">~</span> Population<span class="operator">+</span>Illiteracy<span class="punctuation">,</span>data <span class="operator">=</span> states<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">AIC<span class="punctuation">(</span>fit1<span class="punctuation">,</span>fit2<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>结果显示，fit2的拟合度更好，但是如果变量数过多，那么组合起来的拟合模型数将是巨大的，再用AIC()两两比较就不太可行了</p>
<p>这个时候，对于变量的选择可以使用逐步回归法和全子集回归法。</p>
<p>逐步回归法中，模型会依次添加或者删除一个变量直到达到某个节点为止，这个节点就是继续添加或者删除变量，模型不再继续变化。如果每次是增加变量，那么就是向前逐步回归，如果每次是删除变量，那么就是向后逐步回归。</p>
<p>全子集回归法是取所有可能的模型，然后从中计算出最佳的模型，很显然全子集回归法要比逐步回归法要好，因为会检测到所有的模型，把可能的模型都纳入考虑之中，但是缺点就是如果变量数太多，会涉及到大量的计算，运算会比较慢。</p>
<p>这两种方法都需要通过R的扩展包来实现，MASS包中的stepAIC()函数可以进行逐步回归法的计算</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> library<span class="punctuation">(</span>MASS<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> states <span class="operator">&lt;-</span> as.data.frame<span class="punctuation">(</span>state.x77<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Murder&quot;</span><span class="punctuation">,</span><span class="string">&#x27;Population&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;Illiteracy&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;Income&#x27;</span><span class="punctuation">,</span><span class="string">&quot;Frost&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> fit <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>Murder <span class="operator">~</span> Population<span class="operator">+</span>Illiteracy<span class="operator">+</span>Income<span class="operator">+</span>Frost<span class="punctuation">,</span>data <span class="operator">=</span> states<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> stepAIC<span class="punctuation">(</span>fit<span class="punctuation">,</span>direction <span class="operator">=</span> <span class="string">&quot;backward&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>Leaps包中的regsubsets()函数可以进行全子集回归的计算</p>
<p>但是拟合效果最佳但没有实际意义的模型是没有用的，所以我们始终要对数据有所了解。</p>
<h3 id="003-回归诊断"><a href="#003-回归诊断" class="headerlink" title="003 回归诊断"></a>003 回归诊断</h3><p>找到回归模型之后，我们仍需要解决以下的问题：</p>
<ul>
<li>这个模型是否是最佳的模型？</li>
<li>模型最大程度满足OLS模型的统计假设？</li>
<li>模型是否经得起更多数据的检验？</li>
<li>如果拟合出来的模型指标不好，该如何继续下去？</li>
</ul>
<p>我们需要从多个维度对回归分析的结果进行诊断</p>
<ul>
<li>除了利用summary()函数统计出来的各个指标进行检验，还可以用plot()函数进行绘图，可以生成评价拟合模型的四幅图</li>
</ul>
<p>下面我们来举个例子：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">我们还是使用women这个数据集：</span><br><span class="line"></span><br><span class="line">fit <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>weight <span class="operator">~</span> height<span class="punctuation">,</span>data <span class="operator">=</span> women<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">par<span class="punctuation">(</span>mfrow<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116184730.png"></p>
<p><code>par()</code>函数可以修改plot()函数的绘图参数，par()函数的<em>mfrow</em>选项参数可以定制图形的分布，默认是一张图上显示一幅图，可以使这个参数等于c这个向量，mfrow&#x3D;c(2,2)表示横排显示两幅，纵排显示两幅，这样就可以将四幅图显示在一个画面内。</p>
<p>不是所有的数据都可以使用OLS模型进行拟合的，需要满足以下的前提条件：</p>
<ul>
<li>正态性：对于固定的自变量值，因变量需要呈正态的分布</li>
<li>独立性:自变量之间相互独立</li>
<li>线性：因变量与自变量之间为线性相关</li>
<li>同方差性：因变量的方差不随自变量的水平不同而变化，也可以称作不变方差</li>
<li>第一幅图是残差与拟合的图，这幅图用来表示因变量与自变量是否呈线性关系，图中的点是残差值的分布，线为拟合曲线。如果图中是一个曲线的分布，说明可能存在二次项的分布</li>
<li>第二幅图是R中比较常见的qq图，QQ图用来描述正态性，如果数据呈正态分布，那么在QQ图中就是一条直线</li>
<li>第三幅图是位置与尺寸图，用来描述同方差性，如果满足不变方差的假设，那么图中水平线周围的点应该是随机分布的</li>
<li>第四幅图是残差与杠杆图，提供了对单个数据值的观测，从图中可以看到哪些点偏差较远，可以用来鉴别离群点、高杠杆点和强影响点，高杠杆点表示它是一个异常的预测变量的组合；强影响点表示这个值对模型参数的估计产生的影响较大，如果删除或者转换就可能违背客观数据的事实</li>
</ul>
<p>但是这四幅图没办法说明数据是否具有独立性</p>
<p>只能从收集的数据中验证，要判断收集的数据是否独立，我们可以拟合函数再加一个二次项，再绘制一次图看一下。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fit2 <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>weight <span class="operator">~</span> height<span class="operator">+</span>I<span class="punctuation">(</span>height<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span>data <span class="operator">=</span> women<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> opar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>no.readonly <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> par<span class="punctuation">(</span>mfrow<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> plot<span class="punctuation">(</span>fit2<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>结果明显好一些：<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185001.png" alt="400"><br>抽样法验证：</p>
<ol>
<li>数据集中有1000个样本，随机抽取500个数据进行回归分析；</li>
<li>模型建好之后，利用predict()函数，对剩余的500个样本进行预测，比较残差值</li>
<li>如果预测准确，说明模型可以，否则就需要调整模型</li>
</ol>
<h3 id="004-方差分析"><a href="#004-方差分析" class="headerlink" title="004 方差分析"></a>004 方差分析</h3><p>方差分析称为analysis of variance，简称ANOVA，也称为变异数分析，用于两个及两个以上样本均属差别的显著性检验，从广义上来讲，方差分析也属于回归分析的一种，只不过线性回归的因变量一般是连续型变量，而当自变量是因子时，研究关注的重点通常会从预测转向不同组之间差异的比较，这就是方差分析。</p>
<p>方差分析会大量用在科学研究中，例如实验设计时，进行分组比较，例如药物研究实验，处理组与对照组进行比较</p>
<p>方差分析也分为很多种，比如单因素方差分析，双因素方差分析、协方差分析、多元方差分析、多元协方差分析（R语言实战这本书中有详细介绍）</p>
<p>方差分析多采用aov()函数进行分析，aov()函数的用法与lm()函数类似。下表中列出了R中aov()函数的符号用法：<img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185107.png"></p>
<p>各种方差分析公式的写法：<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185122.png"></p>
<p>变量的顺序很重要：<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185136.png"></p>
<h3 id="005-功效分析"><a href="#005-功效分析" class="headerlink" title="005 功效分析"></a>005 功效分析</h3><p>这节课程我们讨论一下，在数据分析的筹备阶段，我们应该选择多少样本，在一个分析中，如果样本数量过小，那么就算pvalue值非常小，非常显著，也是不可信的。</p>
<p>功效分析（power analysis）可以帮助在给定置信度的情况下，判断检测到给定效应值时所需的样本量，反过来，它也可以在给定置信度水平的情况下，计算在某样本量内能检测到给定效应值的概率。<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185214.png"></p>
<p>功效分析的理论基础：<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185226.png"><br>第一类错误：弃真，第二类错误：存伪</p>
<p><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185239.png"><br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185251.png"></p>
<p>所以我们根据要检验的显著性水平、功效和效应值来推算所需要的样品数，R中利用pwr包来进行功效分析。</p>
<p>在pwr中包含了多种功效分析的函数，根据不同的假设检验选择不同的函数：</p>
<p>下面介绍线性回归功效分析的案例</p>
<h3 id="006-广义线性模型"><a href="#006-广义线性模型" class="headerlink" title="006 广义线性模型"></a>006 广义线性模型</h3><p>在现实生活中，大部分数据都是无规则分布的，要通过数据分析找到规律。</p>
<p>广义线性模型扩展了线性模型的框架，它包含了非正态因变量的分析，在R中可以通过glm()函数进行广义线性回归分析（具体可以参考R语言实战p283）</p>
<p>这里我们使用breslow数据集进行演示，这个数据集是遭受轻微或严重性癫痫病的病人的年龄和发病数进行的记录</p>
<p>响应变量是后八周内癫痫病发病数sumy，预测变量为治疗条件(trt)，年龄(age)以及前八周的基础癫痫病发病数(base)，之所以包含年龄(age)以及发病数(base)，是因为他们对响应变量有潜在的影响，属于协变量，在解释这些协变量之后，才能知道药物治疗对癫痫病的影响</p>
<h3 id="007-logistic-回归"><a href="#007-logistic-回归" class="headerlink" title="007 logistic 回归"></a>007 logistic 回归</h3><p>logistic </p>
<h3 id="008-主成分分析"><a href="#008-主成分分析" class="headerlink" title="008 主成分分析"></a>008 主成分分析</h3><p>PCA</p>
<h3 id="009-因子分析"><a href="#009-因子分析" class="headerlink" title="009 因子分析"></a>009 因子分析</h3><p>探索性因子分析法（exploratory factor analysis），简称EFA，是一系列用来发现一组变量的潜在结构的方法，它通过寻找一组更小的、潜在的或隐藏的结构来解释已观测到的、显式的变量间的关系。<br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185455.png"><br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185501.png"><br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185506.png"><br><img src="/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/Pasted%20image%2020221116185512.png"></p>
<h3 id="010-购物篮分析-关联性分析"><a href="#010-购物篮分析-关联性分析" class="headerlink" title="010 购物篮分析 - 关联性分析"></a>010 购物篮分析 - 关联性分析</h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="http://example.com">pigudog</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/">http://example.com/2022/11/16/R%E8%AF%AD%E8%A8%80/R4/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/R/">R</a></div><div class="post_share"><div class="social-share" data-image="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> Donate</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/16/%E7%94%9F%E4%BF%A1%E5%88%86%E6%9E%90/BIA11/"><img class="prev-cover" src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg2.png0,limit_1/sharpen,100" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info"></div></div></a></div><div class="next-post pull-right"><a href="/2022/11/15/%E7%94%9F%E4%BF%A1%E5%88%86%E6%9E%90/BIA10/"><img class="next-cover" src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg2.png0,limit_1/sharpen,100" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Introduction to ATAC-seq</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/08/21/R%E8%AF%AD%E8%A8%80/R0/" title="R0 - R语言简介和报错整理"><img class="cover" src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-21</div><div class="title">R0 - R语言简介和报错整理</div></div></a></div><div><a href="/2022/08/21/R%E8%AF%AD%E8%A8%80/R1/" title="R1 - R语言的配置和安装"><img class="cover" src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg2.png0,limit_1/sharpen,100" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-21</div><div class="title">R1 - R语言的配置和安装</div></div></a></div><div><a href="/2022/08/21/R%E8%AF%AD%E8%A8%80/R2/" title="R2 - 基于生信的R语言学习"><img class="cover" src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg3.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-21</div><div class="title">R2 - 基于生信的R语言学习</div></div></a></div><div><a href="/2022/08/21/R%E8%AF%AD%E8%A8%80/R3/" title="R3 - R语言相关的工具介绍"><img class="cover" src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-21</div><div class="title">R3 - R语言相关的工具介绍</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">pigudog</div><div class="author-info__description">冲冲冲！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">16</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/pigudog"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/pigudog" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/2205638116@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#R%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8%E5%92%8C%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">R语言入门和数据分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.1.</span> <span class="toc-text">基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">数据预处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%BC%BA%E5%A4%B1%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.1.</span> <span class="toc-text">其他缺失数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.3.</span> <span class="toc-text">数据转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#xlsx%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.1.</span> <span class="toc-text">xlsx数据库的安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D"><span class="toc-number">1.3.2.</span> <span class="toc-text">实操</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">数据处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#apply"><span class="toc-number">1.4.1.</span> <span class="toc-text">apply</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lapply-and-sapply"><span class="toc-number">1.4.2.</span> <span class="toc-text">lapply and sapply</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%AD%E5%BF%83%E5%8C%96%E5%92%8C%E6%A0%87%E5%87%86%E5%8C%96-scale"><span class="toc-number">1.4.3.</span> <span class="toc-text">数据的中心化和标准化 scale</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reshape2"><span class="toc-number">1.4.4.</span> <span class="toc-text">reshape2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tidyr-%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.5.</span> <span class="toc-text">tidyr 包的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dplyr-%E5%8C%85"><span class="toc-number">1.4.6.</span> <span class="toc-text">dplyr 包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#intro-of-function-in-R"><span class="toc-number">1.5.1.</span> <span class="toc-text">intro of function in R</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E7%BB%9F%E8%AE%A1%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.2.</span> <span class="toc-text">数学统计函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E7%8E%87%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">概率函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0%E6%80%A7%E7%BB%9F%E8%AE%A1%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">描述性统计函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%91%E6%95%B0%E7%BB%9F%E8%AE%A1%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">频数统计函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8B%AC%E7%AB%8B%E6%80%A7%E6%A3%80%E9%AA%8C%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.2.4.</span> <span class="toc-text">独立性检验函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%80%A7%E5%88%86%E6%9E%90%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.2.5.</span> <span class="toc-text">相关性分析函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%80%A7%E6%A3%80%E9%AA%8C%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.2.6.</span> <span class="toc-text">相关性检验函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%98%E5%9B%BE%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.2.7.</span> <span class="toc-text">绘图函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.2.8.</span> <span class="toc-text">自定义函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%93%8D-%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98"><span class="toc-number">1.6.</span> <span class="toc-text">项目实操-数据分析实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#001-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92"><span class="toc-number">1.6.1.</span> <span class="toc-text">001 线性回归</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E6%8B%9F%E5%90%88%E5%B8%B8%E7%94%A8%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">线性拟合常用的函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#002-%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92"><span class="toc-number">1.6.2.</span> <span class="toc-text">002 多元线性回归</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#003-%E5%9B%9E%E5%BD%92%E8%AF%8A%E6%96%AD"><span class="toc-number">1.6.3.</span> <span class="toc-text">003 回归诊断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#004-%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90"><span class="toc-number">1.6.4.</span> <span class="toc-text">004 方差分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#005-%E5%8A%9F%E6%95%88%E5%88%86%E6%9E%90"><span class="toc-number">1.6.5.</span> <span class="toc-text">005 功效分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#006-%E5%B9%BF%E4%B9%89%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.6.6.</span> <span class="toc-text">006 广义线性模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#007-logistic-%E5%9B%9E%E5%BD%92"><span class="toc-number">1.6.7.</span> <span class="toc-text">007 logistic 回归</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#008-%E4%B8%BB%E6%88%90%E5%88%86%E5%88%86%E6%9E%90"><span class="toc-number">1.6.8.</span> <span class="toc-text">008 主成分分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#009-%E5%9B%A0%E5%AD%90%E5%88%86%E6%9E%90"><span class="toc-number">1.6.9.</span> <span class="toc-text">009 因子分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#010-%E8%B4%AD%E7%89%A9%E7%AF%AE%E5%88%86%E6%9E%90-%E5%85%B3%E8%81%94%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.6.10.</span> <span class="toc-text">010 购物篮分析 - 关联性分析</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/09/18/pigudog/pigudog1-palantir/" title="pigudog1-palantir"><img src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg3.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pigudog1-palantir"/></a><div class="content"><a class="title" href="/2023/09/18/pigudog/pigudog1-palantir/" title="pigudog1-palantir">pigudog1-palantir</a><time datetime="2023-09-17T16:00:00.000Z" title="Created 2023-09-18 00:00:00">2023-09-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/16/statistic/statistic7%20-%20Analysis%20of%20variance%20and%20regression/" title="statistic7 - Analysis of variance and regression"><img src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="statistic7 - Analysis of variance and regression"/></a><div class="content"><a class="title" href="/2023/02/16/statistic/statistic7%20-%20Analysis%20of%20variance%20and%20regression/" title="statistic7 - Analysis of variance and regression">statistic7 - Analysis of variance and regression</a><time datetime="2023-02-15T16:00:00.000Z" title="Created 2023-02-16 00:00:00">2023-02-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/15/statistic/statistic6%20-%20Hypothesis%20testing/" title="statistic6 - Hypothesis testing"><img src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg2.png0,limit_1/sharpen,100" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="statistic6 - Hypothesis testing"/></a><div class="content"><a class="title" href="/2023/02/15/statistic/statistic6%20-%20Hypothesis%20testing/" title="statistic6 - Hypothesis testing">statistic6 - Hypothesis testing</a><time datetime="2023-02-14T16:00:00.000Z" title="Created 2023-02-15 00:00:00">2023-02-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/13/statistic/statistic4%20-%20Sampling/" title="statistic4 - Sampling"><img src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="statistic4 - Sampling"/></a><div class="content"><a class="title" href="/2023/02/13/statistic/statistic4%20-%20Sampling/" title="statistic4 - Sampling">statistic4 - Sampling</a><time datetime="2023-02-12T16:00:00.000Z" title="Created 2023-02-13 00:00:00">2023-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/11/statistic/statistic3%20-%20Law%20of%20large%20numbers%20and%20central%20limit%20law/" title="statistic0 - StatQuest"><img src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg2.png0,limit_1/sharpen,100" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="statistic0 - StatQuest"/></a><div class="content"><a class="title" href="/2023/02/11/statistic/statistic3%20-%20Law%20of%20large%20numbers%20and%20central%20limit%20law/" title="statistic0 - StatQuest">statistic0 - StatQuest</a><time datetime="2023-02-10T16:00:00.000Z" title="Created 2023-02-11 00:00:00">2023-02-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By pigudog</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://pigudog.com">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">简</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>